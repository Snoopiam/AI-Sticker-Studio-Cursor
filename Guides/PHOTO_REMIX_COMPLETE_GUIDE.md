# ðŸŽ¬ AI STICKER STUDIO - COMPLETE PHOTO REMIX GUIDE

## The Ultimate Reference Manual for Transforming Photos into New Realities

**Version**: 1.0  
**Last Updated**: October 17, 2025  
**Audience**: All Users (Beginner to Advanced)

---

## ðŸ“– TABLE OF CONTENTS

1. [Introduction](#1-introduction)
2. [Getting Started](#2-getting-started)
3. [Understanding the Interface](#3-understanding-the-interface)
4. [Photo Upload & Analysis](#4-photo-upload--analysis)
5. [Scene Description System](#5-scene-description-system)
6. [AI-Generated Scene Ideas](#6-ai-generated-scene-ideas)
7. [Generation Modes](#7-generation-modes)
8. [Group Photo Processing](#8-group-photo-processing)
9. [The VFX Pipeline Explained](#9-the-vfx-pipeline-explained)
10. [Advanced Step-by-Step Mode](#10-advanced-step-by-step-mode)
11. [The Before & After Preview System](#11-the-before--after-preview-system)
12. [Troubleshooting & FAQs](#12-troubleshooting--faqs)
13. [Tips & Best Practices](#13-tips--best-practices)
14. [Technical Deep Dive](#14-technical-deep-dive)
15. [Appendix: Quick Reference](#15-appendix-quick-reference)

---

## 1. INTRODUCTION

### What is Photo Remix?

Photo Remix is the most advanced feature in AI Sticker Studio - a professional-grade VFX compositing tool that takes ANY photo and seamlessly integrates the subjects into entirely new, AI-generated environments. It's like having a Hollywood VFX studio at your fingertips.

**The Core Concept:**
Take a photo â†’ Cut out the subjects â†’ Generate a new scene â†’ Place subjects in scene with realistic lighting, shadows, and color grading â†’ Create believable composite

### What Makes Photo Remix Unique?

Unlike simple photo editors or background replacers, Photo Remix uses **VFX Compositor AI** technology that:

- **Analyzes Lighting**: Understands light direction, color, intensity in both original and new scene
- **Re-Lights Subjects**: Actually modifies the lighting on your subjects to match the new environment
- **Generates Shadows**: Creates realistic shadows that anchor subjects to the new scene
- **Applies Color Grading**: Unifies the color palette so nothing looks "pasted on"
- **Blends Edges**: Refines cutout edges for seamless integration

**This isn't background replacement - it's photorealistic scene transportation.**

---

### Key Features

- **ðŸ”ª Automatic Subject Segmentation**: AI automatically cuts out people from backgrounds
- **ðŸ‘¥ Group Photo Support**: Handle multiple people intelligently with "Divide & Conquer" processing
- **ðŸŽ¬ VFX Compositor AI**: Hollywood-grade compositing with professional lighting and shadows
- **ðŸŽ¨ Dual Prompt System**: Separate controls for background scene AND subject modifications
- **ðŸ’¡ AI Scene Ideas**: Get creative suggestions by analyzing your uploaded photo
- **ðŸŽ¯ Two Generation Modes**: Simple one-click OR Advanced step-by-step control
- **ðŸ“¸ Before & After View**: Split-screen comparison to see transformation
- **ðŸ”„ Iterative Workflow**: Modify and regenerate individual steps without starting over

### Real-World Use Cases

**Personal:**
- Place yourself in dream vacation locations
- Create "what if" scenarios (you as superhero, astronaut, etc.)
- Holiday cards with fantastical backgrounds
- Dating profile photos with interesting environments

**Creative:**
- Conceptual photography without travel
- Fantasy character portraits
- Before/after transformation demonstrations
- Book cover mockups

**Professional:**
- Product photography with custom backgrounds
- Portrait photography with impossible locations
- Social media content creation
- Marketing materials

---

### Prerequisites

- **Credits**: Varies by photo type
  - Single subject: 5 credits
  - Group photo: 6-20+ credits (depends on people count and whether you modify subjects)
- **Clear Photo**: Any photo with at least one person clearly visible
- **Creative Vision**: Idea of where you want to transport your subjects
- **Internet Connection**: Required for all AI processing

### Photo Remix vs Other Studios

| Feature | Photo Remix | Sticker Studio | Wallpaper Studio |
|---------|-------------|----------------|------------------|
| **Input** | Any photo (new each time) | Your photo (calibrated once) | Library characters (reusable) |
| **Output** | Composited photo | PNG/MP4 stickers | High-res wallpapers |
| **Subject Handling** | Cuts out from photo | Preserves identity | Integrates pre-made |
| **Main Use** | Transform existing photos | Create sticker packs | Showcase in scenes |
| **Reusability** | Per-photo processing | 1 calibration â†’ âˆž stickers | 1 character â†’ âˆž wallpapers |
| **Cost** | 5+ credits | 1 credit/sticker | 3 credits |
| **Time** | 30-60 seconds | 5-10s per sticker | 10-45 seconds |
| **Best For** | One-off transformations | Building sticker library | Device backgrounds |

---


## 2. GETTING STARTED

### First Launch Experience

When you open Photo Remix for the first time, you'll see a clean, focused 3-section layout:

1. **Upload Section** (top): Where you upload your photo
2. **Prompt Section** (middle): Where you describe the transformation
3. **Generation Mode** (bottom-ish): Simple or Advanced toggle
4. **Action Footer** (very bottom): Inspire Me and Generate buttons

**On the Right Side:**
- **Before & After Preview**: Split-screen showing original (left) and transformed (right) photos
- Initially shows AI Core animation with instructions

---

### Your First Photo Remix: Quick Start

**The Fastest Path to Your First Remix:**

1. **Upload a Photo**
   - Click the upload area
   - Select any photo with at least one person

2. **Wait for Analysis** (10-15 seconds)
   - AI removes background automatically
   - AI generates creative scene ideas
   - Original + Cutout images appear in upload area

3. **Describe New Scene**
   - In "Background Scene" field, type where you want to be
   - Example: "On the surface of Mars with red desert and Earth in sky"

4. **Modify Subject (Optional)**
   - In "Subject Modifications" field, describe changes
   - Example: "Change clothing to astronaut space suit"
   - OR leave blank to keep subject as-is

5. **Generate**
   - Leave "Group Photo?" toggle OFF (if single person)
   - Leave "Advanced Mode" OFF
   - Click "Generate Remix"

6. **View Result**
   - Wait 30-40 seconds
   - Before/After comparison appears
   - Download or save to collection

**Your first remix will be ready in under 1 minute!**

---

### Understanding Credit Costs

Photo Remix has **variable costs** depending on your photo:

#### **Single Subject Photo:**
- **Cost**: 5 credits (fixed)
- Includes:
  - Background removal (segmentation)
  - Background scene generation
  - Subject modification (if specified)
  - Final compositing with VFX lighting/shadows

#### **Group Photo:**
- **Base Cost**: 1 credit (subject detection)
- **+ Background**: 2 credits (scene generation)
- **+ Composite**: 2 credits (final assembly)
- **+ Subject Modifications**: 1 credit Ã— number of people (if foreground prompt used)

**Example Calculations:**

**2 people, no subject modifications:**
- 1 (detection) + 2 (background) + 2 (composite) = **5 credits**

**3 people, WITH subject modifications:**
- 1 (detection) + 3Ã—1 (remix 3 people) + 2 (background) + 2 (composite) = **8 credits**

**5 people, WITH subject modifications:**
- 1 + 5Ã—1 + 2 + 2 = **10 credits**

**Why Variable Pricing?**
Group photos require "Divide and Conquer" processing - each person is processed individually, then reassembled. More people = more processing = more credits.

---

## 3. UNDERSTANDING THE INTERFACE

### The Control Panel (Left Side)

Photo Remix has the simplest, most focused layout of all three studios.

#### **Section 1: Upload Your Photo**

**Top-Right Corner:**
- "Group Photo?" toggle switch
- Purple when ON, gray when OFF
- **When to use**: Photo has 2+ people you want to keep

**Upload Area:**
- Large dashed-border box
- Click to browse files
- OR drag & drop photo
- OR paste (Ctrl+V) image from clipboard
- OR drag from Collection

**States:**

**Empty State:**
- Upload icon
- "Click, Paste, or Drag & Drop"
- "The AI will automatically cut out the main subjects"

**Processing State:**
- Animated AI Core (purple pulsing)
- "Analyzing photo and removing background..."
- "Generating creative scene ideas..."

**Loaded State:**
- Shows 2 images side-by-side:
  - **Original**: Your uploaded photo (full background intact)
  - **Cutout**: AI-generated cutout (transparent background with checkerboard pattern)

**Purpose of Side-by-Side:**
- Verify segmentation quality
- See what will be placed in new scene
- Check if all subjects were captured

---

#### **Section 2: Describe the New Scene**

**Header:** "2. Describe the New Scene"

**Background Scene Field** (Required):
- Large textarea (3 rows)
- Placeholder: "e.g., An epic battle on Mars with Earth in the sky, cinematic lighting"
- This is WHERE you want subjects to be placed
- Disabled until photo is uploaded and processed

**Subject Modifications Field** (Optional):
- Second textarea (3 rows)
- Placeholder: "Describe how to modify the subjects (clothing, props, etc.). Leave blank for no changes."
- This is HOW you want subjects changed (clothing, accessories, appearance)
- Can be left blank!
- Disabled until photo is uploaded

**AI-Generated Ideas** (appears after upload):
- Shows 4 creative suggestions
- Each has catchy title
- Click any suggestion to auto-fill BOTH prompt fields
- Suggestions are photo-specific (AI analyzed your photo)

---

#### **Section 3: Generation Mode**

**Header:** "3. Generation Mode"

**Advanced (Step-by-Step) Toggle:**
- Switch OFF = Simple mode (one-click generation)
- Switch ON = Advanced mode (manual step control)
- Purple when ON, gray when OFF

**Simple Mode** (Default, Recommended):
- Click one button
- All steps happen automatically
- Fastest and easiest

**Advanced Mode**:
- 3 separate buttons (one per step)
- You control each step manually
- See intermediate results
- More credits spent but more control

---

### The Preview Area (Right Side)

#### **The Before & After Layout**

**Before Panel** (Left Half):
- Header: "Before"
- Shows your original uploaded photo
- Full size in preview
- This is the source photo you uploaded

**After Panel** (Right Half):
- Header: "After"
- Shows the final remixed result
- Before generation: Shows AI Core with instructions
- After generation: Shows your transformed photo

**Split View Benefit:**
- Instant comparison
- See transformation impact
- Verify quality
- Visual proof of VFX quality

---

### The Action Footer

**Left Side: "Inspire Me" Button**
- Provides creative remix ideas
- Works even before uploading (generic suggestions)
- Works after uploading (photo-specific suggestions)
- Fills scene description automatically

**Right Side: Generate Button**

**Simple Mode Button:**
- "Generate Remix (Cost: 5)" for single subject
- "Analyze & Generate (Costs Vary)" for group photos
- Purple background
- Disabled when:
  - No photo uploaded
  - No background prompt
  - Currently processing
  - Insufficient credits

**Advanced Mode Buttons:**
- Three separate teal buttons in a row:
  1. "1. Remix Subjects (1)" - Optional, only if modifying subjects
  2. "2. Gen Background (2)" - Required
  3. "3. Composite (2)" - Required for final result

---

## 4. PHOTO UPLOAD & ANALYSIS

### Uploading Your Photo

#### **Upload Methods:**

**Method 1: Click to Browse**
1. Click anywhere in upload area
2. File picker opens
3. Select image file
4. Upload begins automatically

**Method 2: Drag & Drop**
1. Open photo in file explorer
2. Drag file over upload area
3. Area highlights purple
4. Drop file
5. Upload begins

**Method 3: Paste from Clipboard**
1. Copy image to clipboard (Ctrl+C)
2. Switch to Photo Remix
3. Click anywhere in control panel
4. Press Ctrl+V
5. Upload begins

**Method 4: Drag from Collection**
1. Open Collection modal
2. Find previous remix result
3. Drag to upload area
4. Re-processes that photo

**Supported Formats:**
- JPG/JPEG (most common)
- PNG (with or without transparency)
- HEIC/HEIF (Apple photos - auto-converted)
- WebP
- Any browser-supported image format

---

### The Automatic Analysis Process

When you upload, the AI performs **2 critical operations**:

#### **Operation 1: Background Segmentation** (Critical - MUST succeed)

**What Happens:**
```
Your photo â†’ AI analysis â†’ Subject(s) identified â†’ Background removed â†’ Clean cutout created
```

**Technical Details:**
- Uses `gemini-2.5-flash-image-preview` model
- AI receives prompt: "Perform perfect, studio-quality background removal"
- Output: Image with transparent alpha channel
- Time: 5-10 seconds

**What's Preserved:**
- All people in photo
- Hair details (including fine strands)
- Clothing
- Props being held
- Original pose and expression

**What's Removed:**
- Entire background
- Objects not touching subjects
- Background people (if clearly background)

**Quality Indicators:**
- **Clean edges**: Hair, clothing edges are clean
- **No artifacts**: No weird cutout issues
- **Complete subjects**: All parts of people included
- **Transparent BG**: Checkerboard pattern visible in preview

**If Segmentation Fails:**
- Error message appears
- No credits charged
- Upload different photo
- Common causes: Very blurry photo, subjects blend with background, extreme lighting

---

#### **Operation 2: AI Scene Suggestions** (Non-Critical - can fail gracefully)

**What Happens:**
```
Your photo â†’ AI analyzes â†’ Identifies subjects & context â†’ Generates 4 creative remix ideas
```

**What AI Analyzes:**
- Who's in the photo (number of people, poses)
- Current setting/context
- Mood and vibe
- Potential transformation opportunities

**What AI Generates:**
- 4 diverse remix ideas
- Each idea has:
  - Catchy title ("Neon Guardian", "Cosmic Sentinel")
  - Complete background scene description
  - Subject modification suggestions

**Example:**

**Your Photo:** Person in casual clothes, standing pose

**AI Suggestion 1: "Neon Guardian"**
- Background: "Cyberpunk city at night with neon lights and holographic billboards"
- Foreground: "Transform clothing into sleek, futuristic tactical gear with glowing accents"

**AI Suggestion 2: "Cosmic Sentinel"**
- Background: "Deep space with colorful nebula and distant stars"
- Foreground: "Change into astronaut suit with reflective visor"

**AI Suggestion 3: "Ancient Awakening"**
- Background: "Mystical ancient temple with golden sunset"
- Foreground: "Add flowing robes and mystical energy aura"

**AI Suggestion 4: "Volcanic Ascent"**
- Background: "Active volcano with lava flows and dramatic sky"
- Foreground: "Transform into adventure explorer gear with backpack"

**If Suggestions Fail:**
- Not a problem! Upload still succeeds
- Segmentation (most important) already completed
- You can write your own prompts
- Log message: "Scene suggestions unavailable (you can still create your own prompts)"

**This is NEW behavior** (after recent fixes) - suggestions failure doesn't break upload!

---

### Photo Quality Guidelines

#### **Ideal Photos for Best Results:**

**Subject Clarity:**
- âœ… Subjects in focus
- âœ… Clear facial features visible
- âœ… Good contrast with background
- âŒ Blurry subjects
- âŒ Faces obscured
- âŒ Subjects blend into background

**Lighting:**
- âœ… Even lighting on subjects
- âœ… No extreme shadows
- âœ… Subjects well-exposed
- âŒ Backlit (silhouette)
- âŒ Half face in deep shadow
- âŒ Overexposed (blown out highlights)

**Background:**
- âœ… Distinct from subjects
- âœ… Different colors/tones than subjects
- âœ… Can be complex (AI handles it)
- âŒ Same color as subjects (hard to segment)
- âŒ Subjects perfectly camouflaged

**Composition:**
- âœ… Subjects fully in frame
- âœ… Some space around subjects
- âŒ Subjects cut off at edges
- âŒ Extremely tight crop

**Resolution:**
- âœ… At least 800x800 pixels
- âœ… Higher is better (more detail)
- âŒ Very low resolution (<400px)

**Examples of Great Photos:**
- Outdoor portrait in good daylight
- Indoor photo with even lighting
- Professional headshot
- Casual selfie with clear background
- Action shot with subject in focus

**Examples of Challenging Photos:**
- Concert photo (dim, colored lighting)
- Silhouette against bright window
- Extremely busy background (subjects blend in)
- Very low resolution
- Heavy blur/motion blur

---


## 5. SCENE DESCRIPTION SYSTEM

### The Dual-Prompt Architecture

Photo Remix uses a **unique two-prompt system** that gives you unprecedented control:

**Prompt 1: Background Scene** (Required)
- WHERE do you want subjects to be?
- Describes the new environment/setting
- This is the world you're transporting subjects into

**Prompt 2: Subject Modifications** (Optional)
- HOW do you want subjects changed?
- Describes transformations to subjects themselves
- Can be left blank if no changes needed

**Why Two Prompts?**
- **Separation of Concerns**: Scene and subject controlled independently
- **Flexibility**: Change scene OR subject OR both
- **Clarity**: AI receives unambiguous instructions
- **VFX Workflow**: Mirrors professional compositing (background plate + foreground elements)

---

### Background Scene Prompt (Field 1)

**Purpose:** Describe the new environment where subjects will be placed.

#### **What to Include:**

**1. Location/Setting** (Essential)
```
- Specific place: "The surface of Mars", "Inside a cyberpunk nightclub"
- General environment: "A misty forest", "An underwater coral reef"
- Architectural detail: "Gothic cathedral interior", "Modern glass skyscraper rooftop"
```

**2. Lighting/Time** (Highly Recommended)
```
- Time of day: "at sunset", "during golden hour", "at midnight"
- Light source: "with dramatic spotlights", "in soft morning light"
- Lighting mood: "cinematic lighting", "moody shadows", "bright and cheerful"
```

**3. Atmospheric Details** (Recommended)
```
- Weather: "with rain falling", "in thick fog", "on a clear day"
- Effects: "with fireflies", "with falling snow", "with lens flares"
- Environmental: "with heat distortion", "underwater caustics", "dust particles in light"
```

**4. Color & Mood** (Optional but Powerful)
```
- Colors: "dominated by purple and cyan", "warm orange and red tones"
- Mood: "mysterious", "energetic", "peaceful", "chaotic"
- Style: "photorealistic", "cinematic", "anime-style", "like a painting"
```

---

#### **Background Prompt Examples by Difficulty:**

**Beginner Level:**
```
A beach at sunset
```
âœ“ Works, but minimal detail

**Intermediate Level:**
```
A tropical beach at golden hour sunset with palm trees swaying in the breeze and gentle waves
```
âœ“âœ“ Good! Specific time, environment details

**Advanced Level:**
```
A pristine tropical beach during golden hour sunset. The sky is painted in vibrant oranges, pinks, and purples. Palm trees line the shore, swaying gently. Crystal-clear turquoise water with gentle, foamy waves. Wet sand reflecting the colorful sky. A sense of paradise and tranquility. Photorealistic, cinematic composition.
```
âœ“âœ“âœ“ Excellent! Comprehensive, atmospheric, detailed

---

#### **Background Prompt Templates:**

**Sci-Fi/Futuristic:**
```
[Location] in a futuristic [setting] with [tech elements]. [Lighting]. [Color scheme]. [Mood].

Example: Inside a massive space station in deep space with floor-to-ceiling windows showing Earth. Soft blue interior lighting. Holographic displays float in mid-air. A sense of wonder and isolation. Cinematic, photorealistic.
```

**Fantasy/Magical:**
```
[Magical location] with [supernatural elements]. [Lighting/magic glow]. [Atmosphere]. [Mood].

Example: A mystical ancient forest with massive glowing mushrooms and ethereal fairy lights. Shafts of magical purple light pierce through dense canopy. Mist swirls at ground level. A sense of enchantment and timeless magic.
```

**Historical/Period:**
```
[Historical setting] from [time period] with [period-accurate details]. [Lighting]. [Mood].

Example: A grand Victorian ballroom from the 1800s with crystal chandeliers and ornate gold decorations. Warm candlelight creates dramatic shadows. Marble floors reflect the light. A sense of elegance and grandeur.
```

**Nature/Outdoor:**
```
[Natural location] at [time] with [weather/conditions]. [Natural elements]. [Mood].

Example: The summit of a snow-capped mountain at sunrise. The sky transitions from deep purple to orange. A sea of clouds fills the valleys below. Crisp, cold air with perfect clarity. A sense of achievement and breathtaking beauty.
```

**Urban/City:**
```
[City type] at [time] with [urban features]. [Activity]. [Lighting]. [Mood].

Example: A bustling Tokyo street crossing at night with massive LED screens and neon signs. Crowds of people blur with motion. Rain creates reflections on pavement. A sense of energy and modern urban life.
```

---

### Subject Modifications Prompt (Field 2)

**Purpose:** Describe changes to the subjects themselves (clothing, accessories, appearance).

#### **What You Can Modify:**

**Clothing:**
```
- "Change clothing to astronaut space suit"
- "Transform outfit into medieval knight armor"
- "Replace clothes with elegant ball gown"
- "Add superhero cape and mask"
```

**Accessories/Props:**
```
- "Add wizard staff in right hand"
- "Place glowing sword in hands"
- "Add futuristic helmet"  
- "Give them angel wings"
```

**Appearance Changes:**
```
- "Add glowing blue eyes"
- "Transform into cyborg with mechanical parts"
- "Add mystical tattoos on arms"
- "Make them appear as hologram"
```

**Effects:**
```
- "Add motion blur suggesting speed"
- "Surrounded by magical energy aura"
- "Covered in snow/ice effects"
- "Emanating fire from hands"
```

---

#### **Subject Modification Examples:**

**No Modifications** (Leave Blank):
```
[Leave Subject Modifications field empty]
```
Result: Subjects appear exactly as in original photo, just in new scene

**Simple Modifications:**
```
Change clothing to match the environment
```
Result: AI interprets and changes clothes contextually

**Specific Modifications:**
```
Transform clothing into a sleek, black tactical suit with glowing purple circuit patterns. Add futuristic visor covering eyes. Give them energy gauntlets on both hands.
```
Result: Detailed, specific transformation as described

---

#### **Important Rules for Subject Modifications:**

**DO:**
- âœ… Be specific about what to change
- âœ… Describe additions clearly
- âœ… Mention colors if important
- âœ… Specify which hand/arm if adding props

**DON'T:**
- âŒ Ask to change the person's identity (face/body)
- âŒ Request contradictory changes ("both armored and shirtless")
- âŒ Mention background elements (use Background Prompt for that)
- âŒ Request removal of body parts

**The VFX AI preserves:**
- Facial features (identity maintained)
- Bone structure
- Overall body proportions
- Original pose

**The VFX AI can change:**
- Clothing/outfits
- Accessories/props
- Surface effects (glowing, wet, covered in snow)
- Additions (wings, aura, weapons)

---

### Combining Both Prompts Effectively

#### **Strategy 1: Environmental Transformation** (Background Only)

**Background:** "A cyberpunk city street at night with neon signs"
**Foreground:** [Leave blank]

Result: You, exactly as in photo, placed in cyberpunk city

**Best For:**
- Testing different environments with same subject
- Focus on scene variety
- Keep yourself recognizable

---

#### **Strategy 2: Complete Transformation** (Both Prompts)

**Background:** "An epic space battle with explosions and starships"
**Foreground:** "Transform into starship pilot with helmet, flight suit, and oxygen mask"

Result: You as space pilot in the middle of space battle

**Best For:**
- Fantasy/sci-fi transformations
- Maximum creativity
- Character cosplay effects

---

#### **Strategy 3: Contextual Matching** (Coordinated)

**Background:** "A formal royal ball in a palace with chandeliers"
**Foreground:** "Change clothing to elegant Victorian ball gown with jewelry"

Result: You in period-appropriate clothing at royal ball

**Best For:**
- Historical scenes
- Themed transformations
- Coherent storytelling

---

#### **Strategy 4: Artistic Interpretation**

**Background:** "A vibrant oil painting of a flower garden in impressionist style"
**Foreground:** "Transform into oil painting style with visible brushstrokes"

Result: You rendered as oil painting in painted garden

**Best For:**
- Artistic exploration
- Style transformation
- Gallery-worthy results

---


## 6. AI-GENERATED SCENE IDEAS

### How the AI Suggestion System Works

After your photo is successfully uploaded and segmented, the AI analyzes it and generates **4 creative remix ideas** tailored to YOUR specific photo.

#### **The Analysis Process:**

**What AI Examines:**
1. **Number of subjects**: Solo or group?
2. **Current pose**: Standing, sitting, action pose?
3. **Current setting**: Indoor, outdoor, studio?
4. **Clothing/Appearance**: Casual, formal, costume?
5. **Mood/Expression**: Happy, serious, energetic?
6. **Props/Context**: Holding anything? Any context clues?

**What AI Creates:**
- 4 distinct, creative transformation ideas
- Each idea is complete and ready to use
- Ideas are diverse (sci-fi, fantasy, historical, artistic)
- Both background AND foreground prompts provided

---

### Using AI-Generated Ideas

#### **How to Use:**

**Display:**
- Appears below prompt fields after upload completes
- Header: "âœ¨ AI-Generated Ideas"
- 4 cards in 2Ã—2 grid (or 4Ã—1 on mobile)
- Each shows catchy title

**Interaction:**
1. Click any idea card
2. **BOTH** prompt fields auto-fill instantly:
   - Background Scene = suggestion's background prompt
   - Subject Modifications = suggestion's foreground prompt
3. Review and edit if desired (or use as-is)
4. Click Generate

**Benefits:**
- **Instant Creativity**: No writer's block
- **Photo-Specific**: Suggestions match your photo's context
- **Complete Package**: Both prompts provided
- **Diverse Options**: 4 different genres/moods

---

#### **Typical Suggestion Categories:**

The AI usually provides one suggestion from each category:

**Category 1: Sci-Fi/Futuristic**
- Common titles: "Neon Guardian", "Cyber Sentinel", "Cosmic Explorer"
- Typical backgrounds: Space stations, cyberpunk cities, alien planets
- Typical modifications: Futuristic suits, tech gear, glowing elements

**Category 2: Fantasy/Magical**
- Common titles: "Ancient Awakening", "Mystic Oracle", "Elemental Master"
- Typical backgrounds: Magical forests, castles, mystical realms
- Typical modifications: Robes, magical auras, fantasy weapons

**Category 3: Action/Adventure**
- Common titles: "Volcanic Ascent", "Ocean Depths", "Mountain Conqueror"
- Typical backgrounds: Extreme environments, natural wonders
- Typical modifications: Adventure gear, explorer outfits, protective equipment

**Category 4: Artistic/Stylistic**
- Common titles: "Oil Portrait", "Anime Hero", "Pop Art Icon"
- Typical backgrounds: Artistic interpretations of settings
- Typical modifications: Style transformation (realistic â†’ cartoon, etc.)

---

### Manual Prompt Writing vs AI Suggestions

#### **When to Use AI Suggestions:**
- âœ… You're new to Photo Remix
- âœ… You want creative inspiration
- âœ… Your uploaded photo is generic (suggestions work great)
- âœ… You want to see possibilities
- âœ… You're stuck for ideas

#### **When to Write Manual Prompts:**
- âœ… You have specific vision
- âœ… Suggestions don't match your needs
- âœ… You want personalized/unique scenes
- âœ… You're experienced with Photo Remix
- âœ… Suggestions failed to generate (rare)

#### **Best Approach (Hybrid):**
1. Use AI suggestion as starting point
2. Edit to personalize
3. Add specific details you want
4. Remove elements you don't want
5. Generate!

**Example:**

**AI Suggestion:**
- Background: "A cyberpunk city at night with neon lights"
- Foreground: "Transform into futuristic tactical gear"

**Your Edit:**
- Background: "A cyberpunk city at night with neon lights **and rain, with puddle reflections. Make it look like Blade Runner**"
- Foreground: "Transform into futuristic tactical gear **in black and purple with glowing accents**"

Result: Personalized version of AI's idea!

---

## 7. GENERATION MODES

### Simple Mode (One-Click) â­ RECOMMENDED

**How It Works:**
- Single "Generate Remix" button
- All 3 steps happen automatically in sequence:
  1. Remix subjects (if foreground prompt provided)
  2. Generate background scene
  3. Composite everything together
- You see final result only

**When to Use:**
- âœ… First-time users
- âœ… You want quick results
- âœ… You trust the AI pipeline
- âœ… You don't need to see intermediate steps
- âœ… Standard workflow for 95% of users

**Process:**
1. Upload photo (segmentation happens automatically)
2. Write prompts (background required, foreground optional)
3. Click "Generate Remix"
4. Confirmation dialog appears (shows cost)
5. Click "Confirm"
6. Wait 30-60 seconds
7. Final result appears in "After" panel

**Credit Cost:**
- Single subject: 5 credits (all-inclusive)
- Group photo: Variable (shown in confirmation)

---

### Advanced Mode (Step-by-Step)

**How It Works:**
- Toggle "Advanced (Step-by-Step)" ON
- 3 separate buttons appear, one for each step
- You click each step individually
- See and verify intermediate results
- More control, more clicks, more granular credit spending

**When to Use:**
- âœ… You want maximum control
- âœ… You want to see each step's result
- âœ… You're troubleshooting
- âœ… You want to iterate on one step without regenerating others
- âœ… You're learning how VFX compositing works

---

#### **The 3 Advanced Steps Explained:**

**Step 1: Remix Subjects** (Optional)
- **Button:** "1. Remix Subjects (1)"
- **Cost:** 1 credit
- **Requires:** Foreground prompt filled + Cutout exists
- **What it does:** Modifies subjects according to foreground prompt
- **Output:** Remixed cutout (subjects with modifications, still transparent BG)
- **Preview:** Appears in step preview area (shows remixed subjects)
- **When to skip:** Leave foreground prompt blank if no modifications needed

**Step 2: Generate Background** (Required)
- **Button:** "2. Gen Background (2)"
- **Cost:** 2 credits
- **Requires:** Background prompt filled + Original image exists
- **What it does:** Creates new background scene from your description
- **Output:** New background image (no subjects yet)
- **Preview:** Appears in step preview area (shows generated scene)
- **This step is always needed**

**Step 3: Composite** (Required for Final Result)
- **Button:** "3. Composite (2)"
- **Cost:** 2 credits
- **Requires:** Background generated + Cutout exists (original or remixed)
- **What it does:** VFX compositing with lighting, shadows, color grading
- **Output:** Final combined image
- **Preview:** Appears in "After" panel (full result)
- **This creates the final remix**

---

#### **Advanced Mode Step Preview**

When Advanced Mode is ON, you see a mini-preview row showing each step's result:

**Preview Row Layout:**
```
[Subjects] | [BG] | [Final]
```

**Before Generation:**
- All three show gray placeholder boxes
- Labeled: "Subjects", "BG", "Final"

**After Step 1 (Remix Subjects):**
- Subjects box shows remixed cutout (transparent BG)
- BG and Final still gray

**After Step 2 (Generate Background):**
- Subjects box shows remixed cutout (or original if step 1 skipped)
- BG box shows generated background
- Final still gray

**After Step 3 (Composite):**
- All three boxes show images
- Final box shows complete remix
- Full result also appears in main "After" panel

**Purpose:**
- Visual progress tracking
- Verify each step's output
- Debug issues easily
- Understand the pipeline

---

### Simple vs Advanced: Which to Choose?

#### **Choose Simple Mode If:**
- You're a beginner
- You want fast results
- You're happy with automated workflow
- You don't need to see intermediate steps
- You trust the AI (it's very good!)
- You want standard single-subject remix

**Advantage:** Fastest, easiest, all-inclusive pricing

---

#### **Choose Advanced Mode If:**
- You're experienced/technical user
- You want to verify each step
- You're troubleshooting an issue
- You only want to regenerate one step
- You want to learn the VFX process
- You want to save credits by skipping Step 1

**Advantage:** Maximum control, can iterate on single steps

---

### Advanced Mode Workflow Examples

#### **Scenario A: Skip Subject Modifications** (Save 1 Credit per Person)

**Goal:** Place subjects in new scene without changing them

**Steps:**
1. Upload photo
2. Fill background prompt only (leave foreground blank)
3. Toggle Advanced Mode ON
4. **Skip Step 1** entirely (no button click)
5. Click "2. Gen Background" (costs 2)
6. Click "3. Composite" (costs 2)

**Total Cost:** 4 credits (vs 5 in Simple mode, because Step 1 skipped)
**Result:** Subjects as-is in new scene

---

#### **Scenario B: Iterate on Background** (Refine Scene)

**Goal:** Try multiple backgrounds without re-processing subjects

**Steps:**
1. Upload photo
2. Fill foreground prompt (modify subjects how you want)
3. Fill background prompt (first scene idea)
4. Click "1. Remix Subjects" (costs 1)
5. Click "2. Gen Background" (costs 2)
6. **Don't like background?** Change background prompt
7. Click "2. Gen Background" again (costs 2 more)
8. Repeat until satisfied with background
9. Click "3. Composite" (costs 2)

**Benefit:** Remix subjects once, try multiple backgrounds

---

#### **Scenario C: Iterate on Composite** (Refine Integration)

**Goal:** Keep background and subjects, re-do compositing with different settings

**Steps:**
1. Complete all 3 steps
2. View final result - lighting not quite right
3. Go to Section 3 in Wallpaper Settings (uses same composition settings)
4. Adjust Lighting Style or Blending Mode
5. Click "3. Composite" again (costs 2)

**Benefit:** Refine integration without regenerating expensive steps

---


## 8. GROUP PHOTO PROCESSING

### Understanding the Group Photo Toggle

**Location:** Top-right corner of Section 1 (Upload area)

**The Toggle:**
- Label: "Group Photo?"
- OFF (gray): Treat as single subject photo
- ON (purple): Treat as group photo with multiple people

---

### When to Enable Group Photo Mode

#### **Enable (Toggle ON) When:**
- âœ… Photo has 2 or more people
- âœ… You want to keep ALL people in the remix
- âœ… People are distinct individuals (not crowd/background)
- âœ… Each person should be processed separately for best quality

#### **Leave Disabled (Toggle OFF) When:**
- âœ… Photo has 1 person
- âœ… Photo has multiple people but you only want one (AI picks most prominent)
- âœ… Background people you don't want included
- âœ… Faster processing preferred

---

### The "Divide and Conquer" Algorithm

When Group Photo mode is enabled, Photo Remix uses an advanced processing strategy:

#### **Phase 1: Subject Detection**

**After upload and segmentation:**
1. Click "Generate Remix" button
2. System shows: "Analyzing subjects to calculate cost..."
3. AI analyzes the cutout to detect individual people:
   - **detectSubjectsInCutout()** API called
   - AI identifies each person
   - Creates bounding box for each
   - Assigns ID and description

**Example Detection Result:**
```
Subject 1: "person on the left with red shirt"
  Bounding box: [0.2, 0.1, 0.9, 0.45]

Subject 2: "person on the right with blue shirt"
  Bounding box: [0.2, 0.55, 0.9, 0.95]
```

---

#### **Phase 2: Cost Calculation**

**Dynamic Pricing Formula:**
```
Total Cost = Base Cost + Remix Cost + Background Cost + Composite Cost

Base Cost = 1 credit (subject detection)
Remix Cost = Number of people Ã— 1 credit (if foreground prompt used, 0 if blank)
Background Cost = 2 credits (scene generation)
Composite Cost = 2 credits (final assembly)
```

**Examples:**

**2 people, no foreground modifications:**
```
1 (base) + 0 (no remix) + 2 (background) + 2 (composite) = 5 credits
```
Same as single subject!

**2 people, WITH foreground modifications:**
```
1 (base) + 2Ã—1 (remix both) + 2 (background) + 2 (composite) = 7 credits
```

**5 people, WITH foreground modifications:**
```
1 (base) + 5Ã—1 (remix all) + 2 (background) + 2 (composite) = 10 credits
```

**Cost-Saving Tip:** Leave foreground prompt blank if you don't need to modify subjects!

---

#### **Phase 3: Confirmation Dialog**

**After cost calculated:**
- Dialog appears with:
  - Title: "Confirm Group Photo Remix"
  - Message: "This photo contains X people. The high-fidelity remix will be a multi-step process."
  - Exact cost shown
  - Buttons: Cancel or Confirm

**You see:**
- Exact number of people detected
- Total credit cost upfront
- No surprises!

---

#### **Phase 4: "Divide and Conquer" Processing**

**If foreground prompt is used:**

1. **Crop Each Person**
   - Cutout image divided into individual crops using bounding boxes
   - Each person becomes separate image
   - Proportions and positions remembered

2. **Remix Each Person Individually**
   - Processing message: "Remixing subject 1 of 3..."
   - Each person processed with foreground prompt
   - 500ms delay between calls (API pacing)
   - Each person gets VFX treatment individually

3. **Reassemble Group**
   - "Re-assembling group..."
   - All remixed individuals stitched back together
   - Original spatial positions preserved
   - Transparent background maintained

4. **Background Generation** (Parallel)
   - Happens simultaneously with subject remixing
   - Saves time!

5. **Final Composite**
   - Reassembled group + Generated background
   - VFX compositing applied to entire group
   - Unified lighting and shadows

---

### Group Photo: Technical Benefits

**Why "Divide and Conquer"?**

**Problem:** Applying modifications to a group simultaneously can cause:
- AI gets confused about which instructions apply to whom
- Inconsistent results across individuals
- One person modified correctly, others not

**Solution:** Process each person individually then reassemble:
- Each person gets full AI attention
- Modifications applied consistently
- Higher quality per individual
- No confusion about who gets what

**The Stitching Magic:**
- Original spatial relationships preserved
- No repositioning (people stay where they were)
- Transparent background maintained throughout
- Seamless reassembly

---

### Group Photo Best Practices

#### **Photo Requirements for Groups:**

**Spacing:**
- People should have clear space between them
- Not overlapping significantly
- AI can detect each person distinctly

**Visibility:**
- All people should be clearly visible
- Not partially obscured behind others
- Faces clearly visible for VFX matching

**Similar Sizing:**
- People roughly same size in frame
- Not one person huge, one tiny
- Makes composition easier

---

#### **Prompt Strategies for Groups:**

**Background Prompts:**
- Make scene spacious enough for multiple people
- Example: "A wide, open desert landscape at sunset" (works for groups)
- Avoid: "A tight phone booth" (won't fit group)

**Foreground Prompts:**
- Instructions apply to ALL people equally
- Example: "Change everyone's clothing to superhero costumes"
- For individual changes: Advanced mode required (process individually)

---

#### **When Group Photo Mode Shines:**

**Perfect Use Cases:**
- Family photos â†’ Transport to dream vacation
- Friend group â†’ Place in fantasy adventure scene
- Couple photos â†’ Romantic fantasy backgrounds
- Team photos â†’ Superhero team transformation

**Challenging Use Cases:**
- Very large groups (6+ people) â†’ Expensive and composition becomes crowded
- People very close together â†’ Hard to segment individually
- Overlapping subjects â†’ Stitching artifacts possible

**Recommendation:** For large groups, consider creating separate remixes or using Wallpaper Studio with character library instead.

---


## 9. THE VFX PIPELINE EXPLAINED

### The Four Pillars of VFX Compositing

Photo Remix is built on professional VFX principles from the film industry. Every AI prompt uses the **Four Pillars** approach from the Prompt Engineering Playbook.

---

### Pillar 1: The Expert Persona - VFX Compositor

**Who the AI Becomes:**

All three core functions (`remixForeground`, `generateBackground`, `compositeImages`) receive this expert persona:

```
You are a Lead VFX Compositor from a world-class film studio, renowned for your mastery of photorealistic integration, light, and shadow.
```

**Key Expertise Activated:**
- **Photorealistic Integration**: Seamlessly blending real subjects with CG backgrounds
- **Light & Color Matching**: Analyzing and matching lighting perfectly
- **Shadow Generation**: Creating realistic shadows that anchor subjects
- **Edge Blending**: Eliminating harsh "cut-out" edges
- **Color Grading**: Unifying color palettes across all elements

**Why This Matters:**
Without the VFX expert persona, AI treats this like simple photo editing. WITH the persona, AI understands this is professional compositing requiring photorealistic quality.

---

### Pillar 2: The Digital Dailies (Context)

**What AI Receives:**

**For Subject Remix:**
- The pre-segmented cutout image (transparent background)
- User's modification instructions
- Mandate to preserve identity

**For Background Generation:**
- The original photo (for context/style reference)
- User's scene description
- Requirements for compositing-ready output (clear lighting, appropriate depth)

**For Compositing:**
- The background scene
- The subject cutout(s)
- Composition specifications (from wallpaper settings)
- Both images as actual image inputs (not descriptions!)

---

### Pillar 3: The Unbreakable Constraints

**Every VFX function has these hard rules:**

**Primary Directive:**
```
"Your highest priority is to create a seamless, photorealistic composite where subjects look naturally and physically present in the new scene."
```

**Lighting & Shadow Requirements:**
```
"The lighting on each subject MUST be altered to match the direction, color, and intensity of the lighting in the background scene. You MUST generate realistic shadows cast by each subject onto the background."
```

**Color Grading Requirement:**
```
"The final image MUST have a unified color grade. Subjects cannot look 'warmer' or 'cooler' than their environment."
```

**Edge Blending Requirement:**
```
"Meticulously refine subject edges to eliminate harsh cutout artifacts."
```

**Perspective & Scale:**
```
"Position and scale subjects consistently with the background's perspective."
```

---

### Pillar 4: The Blueprint (Output Specs)

**Every function specifies:**
- Output must be single, high-resolution image
- Specific format requirements (transparent BG for cutouts, complete composite for final)
- Quality expectations

---

### The 3-Stage VFX Workflow

#### **Stage 1: Foreground Preparation** (Optional)

**Function:** `remixForeground(cutoutBase64, foregroundPrompt)`

**VFX Compositor Prompt Structure:**
```
You are a Lead VFX Compositor specializing in photorealistic integration and identity preservation.

**TASK:**
Artistically modify the person in this pre-segmented image according to: "[Your foreground prompt]"

**CONSTRAINTS:**
- Person's facial features and identity are sacrosanct (cannot be altered)
- Apply only specific modifications requested
- Maintain photorealistic quality
- Output MUST retain transparent background

**OUTPUT:**
High-quality image with modifications, identity preserved, transparent BG.
```

**What Happens:**
- Subject's clothing/appearance modified
- Face/identity untouched
- Edges remain clean
- Transparency preserved
- Takes 5-8 seconds

**Skipped If:**
- Foreground prompt is blank
- You don't need subject modifications

---

#### **Stage 2: Background Scene Generation** (Required)

**Function:** `generateBackground(backgroundPrompt, originalImage)`

**VFX Compositor Prompt Structure:**
```
You are a Lead VFX Compositor specializing in photorealistic scene creation and lighting design. You create environments perfectly suited for seamless photo compositing.

**MISSION:**
Generate a photorealistic background scene for photo compositing. Must have clear lighting direction, appropriate depth, realistic atmospheric qualities.

**SCENE DESCRIPTION:**
[Your background prompt]

**CRITICAL REQUIREMENTS:**
- Scene must be photorealistic with clear, identifiable light sources
- Lighting direction and color temperature consistent
- Depth and perspective clearly established
- Appropriate atmospheric qualities (shadows, ambient light, environmental effects)
- High resolution suitable for professional compositing
- Color palette cohesive for natural subject integration

**CONTEXT:**
Original photo provided as reference for style matching.

**OUTPUT:**
Single, high-resolution, photorealistic background scene optimized for compositing.
```

**What Happens:**
- New background scene generated from your description
- Scene designed with compositing in mind (has depth, clear lighting)
- Reference to original photo ensures style compatibility
- Takes 10-15 seconds

**Model Used:** `imagen-4.0-generate-001` (best for scene generation)

---

#### **Stage 3: VFX Compositing** (Required for Final Result)

**Function:** `compositeImages([foreground], background, settings)`

**VFX Compositor Prompt Structure:**
```
You are a Lead VFX Compositor, the final step in creating seamless composites where subjects look naturally present in new environments.

**MISSION:**
You have been provided with:
- Background scene (first image)
- Pre-segmented foreground subject(s) (with transparency)
- Composition specifications

**PRIMARY DIRECTIVE:**
Create seamless, photorealistic composite where subjects look naturally and physically present in the background scene. Final image must be indistinguishable from a photograph taken in that environment.

**CRITICAL CONSTRAINTS:**
- **Lighting & Shadow**: Lighting on subjects MUST match background lighting (direction, color, intensity). MUST generate realistic shadows cast by subjects onto background.
- **Color Grading**: Final image MUST have unified color grade. Subjects cannot look "warmer" or "cooler" than environment.
- **Perspective & Scale**: Position and scale subjects consistently with background's perspective.
- **Edge Blending**: Meticulously refine subject edges to eliminate harsh cutout artifacts.

**COMPOSITION SPECIFICATIONS:**
- Character Position: [Setting from wallpaper settings]
- Character Size: [Setting from wallpaper settings]
- Blending Mode: [Setting from wallpaper settings]
- Lighting Style: [Setting from wallpaper settings]

**OUTPUT:**
Single, high-resolution, photorealistic composite image.
```

**What Happens:**
1. AI receives actual images (not descriptions!)
2. AI analyzes background lighting (direction, color, intensity)
3. AI re-lights subjects to match
4. AI generates shadows (direction, hardness, opacity)
5. AI applies unified color grade
6. AI refines edges
7. Final composite assembled

**Takes:** 10-15 seconds

**Model Used:** `gemini-2.5-flash-image-preview` (supports image input/output)

---

### Why VFX Compositor Prompts Matter

**Before VFX Prompts (Old System):**
```
Simple prompt: "Place this person on Mars"
```
Result: Person "pasted" on Mars, wrong lighting, no shadows, looks fake

**After VFX Prompts (Current System):**
```
Complete VFX prompt with expert persona, lighting rules, shadow requirements, color grading mandates
```
Result: Person looks like they're actually on Mars, realistic lighting from Martian sun, shadow on ground, unified color palette

**Quality Difference:** Night and day. This is why recent fixes to add VFX personas were marked "CRITICAL" in dev log.

---

## 10. ADVANCED STEP-BY-STEP MODE

### Detailed Breakdown of Each Step

#### **Step 1: Remix Subjects** (Optional Step)

**Button Text:** "1. Remix Subjects (1)"
**Credit Cost:** 1 credit
**Time:** 5-8 seconds per subject

**When to Use:**
- You want to modify subjects (clothing, accessories, effects)
- You filled the "Subject Modifications" prompt field
- You want subjects changed before compositing

**When to Skip:**
- Foreground prompt is blank
- You want subjects exactly as photographed
- Saves 1 credit (or N credits for N people in group)

**What Happens:**
1. Takes your cutout (or each individual in group)
2. Applies your foreground prompt modifications
3. Preserves facial identity (VFX rule)
4. Outputs modified cutout with transparent background

**Result Storage:**
- Stored in `remixState.remixedCutoutImage`
- Appears in step preview (leftmost box)
- Used in Step 3 instead of original cutout

**Technical Note:**
- For group photos, this is done PER PERSON
- Each person cropped individually
- Each person remixed with same prompt
- All pieces stitched back together into single cutout

---

#### **Step 2: Generate Background** (Required Step)

**Button Text:** "2. Gen Background (2)"
**Credit Cost:** 2 credits
**Time:** 10-15 seconds

**When to Use:**
- Always! This creates your new scene
- Required for any remix

**What Happens:**
1. Takes your background prompt
2. Uses original photo as reference for style/mood
3. Generates photorealistic scene
4. Scene designed for compositing (clear lighting, depth, space for subjects)

**Result Storage:**
- Stored in `remixState.generatedBackground`
- Appears in step preview (middle box)
- Used in Step 3 for compositing

**Models & Process:**
- Uses `imagen-4.0-generate-001` (best for scene generation)
- VFX Compositor persona ensures compositing-friendly scene
- Original photo reference helps style matching

**Can Be Regenerated:**
- Click Step 2 again with different background prompt
- Only costs 2 more credits
- Keeps same remixed subjects (don't need to redo Step 1)
- Useful for trying multiple backgrounds

---

#### **Step 3: Composite** (Required for Final Result)

**Button Text:** "3. Composite (2)"
**Credit Cost:** 2 credits
**Time:** 10-15 seconds

**Prerequisites:**
- Step 2 completed (background exists)
- Cutout exists (original or remixed from Step 1)

**What Happens:**
1. Takes background from Step 2
2. Takes cutout (remixed from Step 1, or original if Step 1 skipped)
3. VFX Compositor AI performs professional compositing:
   - Analyzes background lighting
   - Re-lights subjects to match
   - Generates realistic shadows
   - Applies unified color grading
   - Refines edges
4. Outputs final, seamless composite

**Result Storage:**
- Stored in `remixState.finalImage`
- Appears in step preview (rightmost box)
- Appears in main "After" panel (full size)
- This is your final remix!

**Can Be Regenerated:**
- Click Step 3 again after adjusting wallpaper composition settings
- Only costs 2 more credits
- Keeps same background and subjects
- Useful for refining lighting/blending

---

### Advanced Mode Step Dependencies

**Step Flow Chart:**
```
Upload Photo
  â†“
Auto-Segmentation (FREE - part of upload)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Optional   â”‚   Required   â”‚
â”‚   Step 1    â”‚   Step 2     â”‚
â”‚   Remix     â”‚   Gen BG     â”‚
â”‚ (1 credit)  â”‚ (2 credits)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚
       â””â”€â”€â”€â”€â†’ Step 3 â†â”€â”€â”€â”€
              Composite
             (2 credits)
                 â†“
            Final Result
```

**Parallel Processing:**
- If doing Step 1, Step 2 can happen simultaneously (for single subject)
- For groups, Step 1 must complete first (all subjects remixed, then stitched)
- Step 3 always comes last (needs both background and cutout)

---

### Advanced Mode: Credit Optimization Strategies

#### **Strategy 1: Minimal Transformation** (4 Credits)
```
Skip Step 1 (foreground blank)
Do Step 2 (2 credits)
Do Step 3 (2 credits)
Total: 4 credits
```
**Use when:** Just changing background, keeping subjects as-is

---

#### **Strategy 2: Foreground Testing** (1-2 Credits)
```
Do Step 1 (1 credit) â†’ Review â†’ Like it? Continue
Don't like it? â†’ Modify foreground prompt â†’ Redo Step 1 (1 more credit)
Total: 1-2 credits before committing to full remix
```
**Use when:** Experimenting with subject modifications

---

#### **Strategy 3: Background Testing** (2-4 Credits)
```
Do Step 2 (2 credits) â†’ Review background only
Don't like it? â†’ Modify background prompt â†’ Redo Step 2 (2 more credits)
Like it? â†’ Proceed to Step 3
Total: 2-4 credits before final composite
```
**Use when:** Trying multiple scene ideas

---

#### **Strategy 4: Composite Refinement** (2-4 Credits)
```
Complete all 3 steps
Review final result - lighting not perfect
Adjust composition settings (lighting style, blending mode)
Redo Step 3 only (2 credits)
Repeat if needed
Total: +2 credits per composite iteration
```
**Use when:** Fine-tuning integration quality

---


## 11. THE BEFORE & AFTER PREVIEW SYSTEM

### Understanding the Split View

The Preview Area uses a **Before & After comparison layout** unique to Photo Remix.

---

### Before Panel (Left Side)

**Header:** "Before"

**What It Shows:**
- Your original uploaded photo
- Full background intact
- Subjects as photographed
- Original lighting, colors, environment

**Purpose:**
- Reference point for transformation
- See starting material
- Compare to final result
- Verify upload quality

**State Changes:**
- Empty until photo uploaded
- Updates when new photo uploaded
- Persists throughout workflow

---

### After Panel (Right Side)

**Header:** "After"

**States:**

**Idle State** (No photo uploaded):
- AI Core animation
- Message: "Upload a photo to begin"

**Photo Uploaded, Not Generated:**
- AI Core animation
- Message: "Describe the scene and click Generate to see the transformation"

**Generating:**
- Animated AI Core (pulsing)
- Loading message:
  - "Analyzing photo and removing background..."
  - "Remixing subjects & generating background..."
  - "Compositing final image..."
- Progress indication

**Generation Complete:**
- Final remixed photo displayed
- Full size (fits panel while maintaining aspect ratio)
- Quick action buttons on hover:
  - Download
  - Edit
  - View full-size
  - Add to collection

---

### Comparison Features

**Side-by-Side Benefit:**
- Instant visual comparison
- See transformation impact clearly
- Verify quality of integration
- Show off to others

**Visual Cues:**
- Same photo dimensions (scaled to match)
- Aligned vertically
- Easy to spot differences
- Professional before/after presentation

---

### Quick Actions on Results

**Hover over "After" image to reveal:**

**Download Button:**
- Click to download final remix
- Saves as PNG file
- Filename: "remix-[id].png"
- Full resolution

**Edit Button:**
- Opens Post-Processing Studio
- Costs 1 credit per edit
- Can add speech bubbles, remove BG again, apply filters, etc.

**View Button:**
- Opens fullscreen viewer
- Zoom and pan
- Close-up inspection
- Better for large displays

**Save to Collection:**
- Automatically happens on generation
- Manual save also available
- Persists in IndexedDB
- Accessible from Collection modal

---

## 12. TROUBLESHOOTING & FAQs

### Common Issues & Solutions

#### **Problem: "Photo analysis failed" during upload**

**Possible Causes:**

**Cause 1: Network issue**
- Solution: Check internet connection, try again
- No credits charged (failure during free analysis)

**Cause 2: Photo format not supported**
- Solution: Convert to JPG or PNG, try again
- Rare with modern formats

**Cause 3: Photo too large**
- Solution: Resize photo to under 10MB
- Compress using online tool

**Cause 4: Corrupted image file**
- Solution: Re-export photo, try different file

---

#### **Problem: Background segmentation cut out too much/too little**

**Scenario A: AI removed part of subject**
- Example: Hand holding object was removed
- Cause: AI thought object was background
- Solution: Try different photo with better contrast between subject and BG

**Scenario B: AI left background**
- Example: Part of wall still attached to subject
- Cause: Poor contrast or subject blends with background
- Solution:
  - Use photo with clearer subject/background separation OR
  - Use Advanced Mode, manually fix in Step 3 with composition settings OR
  - Upload to Post-Processing Studio, use Remove BG tool again

**General Fix:**
- Photo Remix segmentation is automatic and non-adjustable
- For perfect cutouts, use photos with clear subject/background distinction
- Outdoor photos with sky background work best

---

#### **Problem: "No subjects were detected for group processing"**

**Cause:** Group Photo mode enabled, but AI couldn't detect individual people in cutout

**Why This Happens:**
- Photo actually has 1 person (toggle should be OFF)
- People too close together (AI can't separate)
- Cutout quality too poor for individual detection

**Solutions:**
1. **Toggle Group Photo OFF**, regenerate as single subject
2. Use different photo with clearer subject separation
3. If truly group photo, subjects need clear space between them

---

#### **Problem: "This group photo with X people requires Y credits" - Too expensive!**

**Understanding Cost:**
- More people = higher cost (each person processed individually)
- Cost shown is accurate and upfront

**Solutions to Reduce Cost:**

**Solution 1: Skip Subject Modifications**
- Leave foreground prompt blank
- Saves N credits (where N = number of people)
- Example: 5 people with modifications = 10 credits
- Example: 5 people, no modifications = 5 credits

**Solution 2: Use Fewer People**
- Crop photo to fewer people before uploading
- Use photo editor to crop to desired subjects
- Upload cropped version

**Solution 3: Toggle Group Photo OFF**
- AI picks most prominent person
- Cheaper (5 credits) but only keeps one person

**Solution 4: Use Wallpaper Studio Instead**
- Create individual characters from each person (2 credits each)
- Combine in wallpaper (3 credits)
- Example: 3 people â†’ 2Ã—3 + 3 = 9 credits total
- But then you can reuse characters in unlimited wallpapers!

---

#### **Problem: Subjects look "pasted on" in final result**

**Causes & Fixes:**

**Cause 1: Lighting mismatch**
- Fix: AI should handle this automatically with VFX prompts
- If still happening: Background and original photo have extremely different lighting
- Try: More similar lighting conditions in scene prompt

**Cause 2: Shadow missing/unrealistic**
- Fix: VFX compositor should generate shadows automatically
- If not: Scene description may conflict (e.g., "no shadows" in prompt)
- Try: Don't mention shadows in prompt - let AI handle it

**Cause 3: Color temperature clash**
- Example: Warm-lit subject in cool-lit scene
- Fix: VFX should unify automatically
- If persistent: Try adjusting blending mode in composition settings

**Cause 4: Edge artifacts**
- Harsh cutout edges visible
- Fix: VFX edge blending should handle this
- If persistent: Original photo may have been too blurry

**If All Else Fails:**
- Use Advanced Mode
- Redo Step 3 (Composite) with different settings:
  - Try "Dramatic" blending mode
  - Try "Cinematic" lighting style
- Or use Post-Processing Studio to manually enhance

---

#### **Problem: Generated background doesn't match my description**

**Causes:**

**Cause 1: Vague prompt**
- Solution: Be more specific and detailed
- Add lighting, mood, color details
- Reference specific styles ("like Blade Runner")

**Cause 2: Contradictory prompt**
- Example: "Bright and dark cyberpunk city"
- Solution: Remove contradictions, choose one mood

**Cause 3: AI interpretation differs from expectation**
- This happens! AI is creative
- Solution: Use Advanced Mode, regenerate Step 2 with revised prompt
- Only costs 2 more credits, keeps subjects

---

#### **Problem: Advanced mode buttons disabled**

**Step 1 Disabled:**
- Cause: Foreground prompt is blank OR cutout doesn't exist
- Solution: Fill foreground prompt if you want modifications, or skip Step 1

**Step 2 Disabled:**
- Cause: Background prompt is blank OR original image doesn't exist
- Solution: Fill background prompt (required!)

**Step 3 Disabled:**
- Cause: Background hasn't been generated yet OR cutout doesn't exist
- Solution: Complete Step 2 first

---

### Frequently Asked Questions

**Q: Can I use Photo Remix on photos without people?**
A: No, Photo Remix is designed for photos with people/subjects. For general image editing, use Post-Processing Studio.

**Q: What happens if my photo has pets/animals?**
A: The segmentation AI is trained primarily on people. It may or may not successfully segment animals. Try it! If it works, great. If not, use a different photo.

**Q: Can I remix the same photo multiple times?**
A: Yes! Each remix is independent. Upload once, generate multiple times with different prompts. Credits charged per generation.

**Q: Does Photo Remix create characters for my library?**
A: Not automatically. But you can manually create a character from any photo using the Wallpaper Studio upload feature (2 credits).

**Q: Why is Photo Remix more expensive than wallpapers?**
A: Photo Remix processes new photos each time with full segmentation, analysis, and VFX pipeline. Wallpapers reuse pre-made characters. Different use cases.

**Q: Can I adjust the cutout (segmentation) manually?**
A: Not currently. Segmentation is automatic. For manual control, export cutout to external editor, then upload to Wallpaper Studio.

**Q: What if I want to keep the original background but modify subjects?**
A: Photo Remix always creates new background. For keeping background with modifications, use Post-Processing Studio instead.

**Q: Can I save my prompt combinations?**
A: Not directly, but Collection stores all prompts. View in Collection â†’ "Copy All Data" to export your prompts.

**Q: Why does group photo analysis sometimes take long?**
A: More people = more complex analysis. Each person detected, bounded, and processed. 3-5 people may take 10-15 seconds to analyze.

**Q: Are there limits on group photo size?**
A: No hard limit, but practical limit is 5-6 people due to:
- High credit cost (10+ credits)
- Composition becomes crowded
- Processing time lengthens
- Quality may degrade with too many subjects

---


## 13. TIPS & BEST PRACTICES

### Photo Selection Mastery

#### **The Perfect Photo Remix Photo:**

**Ideal Characteristics:**
1. **Subject Clearly Defined**
   - Strong contrast with background
   - Sharp focus on subjects
   - No motion blur

2. **Good Lighting**
   - Even, soft lighting
   - No extreme shadows on subjects
   - Well-exposed (not too dark or bright)

3. **Clean Background**
   - Distinct from subject colors
   - Not too complex (helps segmentation)
   - Can be any background (will be removed anyway)

4. **Full Subjects in Frame**
   - No cut-off heads or limbs
   - Some space around subjects
   - Complete poses visible

5. **High Resolution**
   - At least 1000Ã—1000 pixels
   - More detail = better results
   - Especially important for faces

**Photo Examples:**

âœ… **Excellent:**
- Outdoor portrait on clear day
- Studio photo with backdrop
- Beach photo with sky background
- Park photo with greenery background

âœ… **Good:**
- Indoor photo with even lighting
- Selfie with plain wall background
- Casual photo in good conditions

âš ï¸ **Challenging:**
- Concert/club photos (dim, colored lights)
- Backlit subjects (silhouette)
- Busy, patterned backgrounds matching subject
- Very low resolution photos

âŒ **Avoid:**
- Extreme blur
- Heavy filters/effects already applied
- Subjects blending into background perfectly
- Faces obscured or cut off

---

### Prompt Writing Strategies

#### **Background Prompt Best Practices:**

**Structure:** [Location] + [Time/Lighting] + [Details] + [Atmosphere] + [Mood/Style]

**Power Phrases:**
- "Cinematic lighting" â†’ Professional Hollywood quality
- "Golden hour" â†’ Warm, beautiful natural light
- "Ultra HD" â†’ Emphasizes quality and detail
- "Photorealistic" â†’ Emphasizes realism
- "Like [reference]" â†’ "like Blade Runner", "like Lord of the Rings"

**Detail Density:**
- Minimum: 1 sentence (works but basic)
- Recommended: 2-3 sentences (good quality)
- Professional: 4-5 sentences (maximum detail)

**Specificity Beats Vagueness:**
- âŒ "A city" â†’ Too vague, unpredictable
- âœ… "A neon-lit cyberpunk city" â†’ Better, specific theme
- âœ…âœ… "A dense cyberpunk city at night, skyscrapers covered in holographic ads, rain-slicked streets" â†’ Excellent!

---

#### **Foreground Prompt Best Practices:**

**When to Use:**
- You want subjects in costume/different clothing
- Adding props or accessories
- Thematic transformation (person â†’ superhero)
- Artistic effects on subjects

**When to Leave Blank:**
- Subjects perfect as-is
- Just changing environment
- Want subjects recognizable
- Saving credits (1 per person)

**Specificity:**
- Be exact about clothing: "astronaut suit" > "space outfit"
- Specify colors: "red superhero cape" > "cape"
- Mention both hands if relevant: "glowing swords in both hands"

**Identity Preservation:**
- Face always preserved (automatic)
- Don't request "make them look different"
- Don't request "change to someone else"
- Modifications apply to clothing/accessories only

---

### Scene & Subject Matching Guidelines

#### **Coherent Combinations:**

**Sci-Fi Scene + Sci-Fi Outfit:**
- Background: "Space station interior with Earth view"
- Foreground: "Astronaut suit with helmet"
- âœ“âœ“ Highly coherent, reinforces theme

**Fantasy Scene + Fantasy Outfit:**
- Background: "Mystical forest with glowing mushrooms"
- Foreground: "Flowing wizard robes with magical staff"
- âœ“âœ“ Perfect match

**Modern Scene + Modern Outfit:**
- Background: "Luxury penthouse apartment at night"
- Foreground: "Elegant evening wear"
- âœ“âœ“ Appropriate match

---

#### **Creative Contrasts** (Can Work!):**

**Casual Outfit + Epic Scene:**
- Background: "Epic space battle with explosions"
- Foreground: [blank - keep casual clothes]
- âœ“ Interesting juxtaposition (everyman in extraordinary situation)

**Formal Outfit + Casual Scene:**
- Background: "Simple coffee shop"
- Foreground: "Formal tuxedo"
- âœ“ Humorous or artistic contrast

---

#### **Incoherent Combinations** (Avoid):**

**Conflicting Styles:**
- Background: "Photorealistic mountain landscape"
- Foreground: "Transform into cartoon character"
- âš ï¸ Style clash - subject won't match scene realism

**Impossible Physics:**
- Background: "Underwater coral reef"
- Foreground: "On fire with flames"
- âŒ Fire underwater doesn't make sense

**Contradictory Instructions:**
- Foreground: "Wearing full spacesuit with helmet covering face"
- âŒ Covers face, loses identity (AI must preserve face)

---

### Simple Mode vs Advanced Mode: Decision Guide

#### **Use Simple Mode (Default) When:**
- âœ… First time using Photo Remix
- âœ… You want fast, automatic results
- âœ… You trust the VFX pipeline
- âœ… Single subject photo (most common)
- âœ… You've written good prompts and want to see result
- âœ… You don't need to iterate on individual steps

**Simple Mode Advantages:**
- One click, automatic processing
- All-inclusive pricing (5 credits covers everything)
- Fastest workflow
- No decisions about step order
- Works perfectly 90% of the time

---

#### **Use Advanced Mode When:**
- âœ… You want granular control
- âœ… You want to verify each step
- âœ… You're troubleshooting an issue
- âœ… You want to try multiple backgrounds without re-remixing subjects
- âœ… You want to skip subject modifications (save credits)
- âœ… You're learning VFX workflow
- âœ… You need to iterate on specific step

**Advanced Mode Advantages:**
- See intermediate results
- Iterate on single steps
- Potential credit savings (skip Step 1 = save 1-N credits)
- Educational (see how VFX works)
- More control over final result

---

### Credit Management for Photo Remix

Photo Remix is the most expensive feature, so spend wisely:

#### **Cost Breakdown:**
- **Single subject, simple mode**: 5 credits (all-inclusive)
- **Group photo**: 5-15+ credits (varies by people count and modifications)
- **Advanced mode steps**: 1-2 credits per step (can add up)

#### **Optimization Strategies:**

**For Testing/Experimentation:**
1. Use single-subject photos (cheaper)
2. Use Simple mode (avoid credit creep from multiple step retries)
3. Write good prompts first time (avoid re-generations)

**For Group Photos:**
1. Only enable Group mode if you truly need all people
2. Consider leaving foreground blank (saves N credits)
3. Or use Wallpaper Studio workflow instead (create characters, then unlimited wallpapers)

**For Iteration:**
1. Use Advanced mode
2. Perfect prompts before clicking buttons
3. Redo only the step that needs changing

**Budget Awareness:**
- Photo Remix: 5-15 credits per image
- Sticker: 1 credit per sticker (much cheaper for iterating)
- Wallpaper: 3 credits (middle ground)
- Choose feature based on need!

---

### Workflow Recommendations

#### **Beginner Workflow** (Minimize Complexity)

1. Upload SINGLE-subject photo (not group)
2. Leave "Group Photo?" toggle OFF
3. Read AI-generated suggestions
4. Click any suggestion you like (auto-fills prompts)
5. Leave Advanced Mode OFF
6. Click "Generate Remix"
7. Wait 30-40 seconds
8. View result in Before/After

**Result:** Professional remix with minimal decisions!

---

#### **Intermediate Workflow** (Custom Creativity)

1. Upload photo (single or group)
2. Set "Group Photo?" correctly
3. Ignore AI suggestions (or use as inspiration)
4. Write custom background prompt (detailed!)
5. Write custom foreground prompt (specific modifications)
6. Leave Advanced Mode OFF
7. Generate
8. Review result
9. If not perfect, upload again with revised prompts

**Result:** Fully customized remix matching your vision!

---

#### **Advanced Workflow** (Maximum Control)

1. Upload photo
2. Review segmentation quality in upload area
3. Write both prompts carefully
4. Toggle Advanced Mode ON
5. **Step 1:** Generate remixed subjects (if needed)
   - Review result in step preview
   - Satisfied? Continue. Not satisfied? Revise foreground prompt, redo Step 1.
6. **Step 2:** Generate background
   - Review result in step preview
   - Satisfied? Continue. Not satisfied? Revise background prompt, redo Step 2.
7. **Step 3:** Composite
   - Review final result
   - Adjust composition settings if needed (Section 3 of Wallpaper settings)
   - Redo Step 3 with new settings if needed

**Result:** Perfected remix with validated intermediate results!

---

#### **Professional Workflow** (For Portfolio/Client Work)

1. **Pre-Production:**
   - Source high-quality photo with professional lighting
   - Plan scene and modifications ahead of time
   - Write detailed prompts in external editor first

2. **Production:**
   - Upload photo
   - Paste pre-written prompts
   - Use Advanced Mode to verify each step
   - Save intermediate results

3. **Post-Production:**
   - Generate remix
   - Review in fullscreen viewer
   - Download full resolution
   - If needed: Further editing in Post-Processing Studio
   - Export final files

4. **Archival:**
   - Save to Collection
   - Export collection data for backup
   - Document settings for reproduction

**Result:** Professional-grade, archival-quality remixes!

---

### Common Mistakes to Avoid

âŒ **Not filling background prompt**
- Required field! Can't generate without it
- Use AI suggestions if stuck

âŒ **Enabling Group Photo for single person**
- Wastes processing time (subject detection unnecessary)
- No quality benefit

âŒ **Writing subject changes in background prompt**
- Wrong field! Subject changes go in foreground prompt
- Background = environment, Foreground = subject modifications

âŒ **Expecting different person's face**
- VFX preserves identity (by design)
- Can't turn you into someone else
- Can change everything except facial features

âŒ **Using heavily filtered photos**
- Filters confuse segmentation AI
- Use original, unfiltered photos

âŒ **Too vague prompts**
- "A city" â†’ Unpredictable, generic results
- Be specific: "A rainy Tokyo street at night with neon signs"

âŒ **Closing browser during generation**
- Interrupts process
- Credits refunded, but you have to start over

---

### Pro Tips

ðŸ’¡ **Use AI Suggestions First**
- Even if you have an idea, check suggestions
- May inspire better ideas
- Often higher quality than quick manual prompts
- Free creativity boost!

ðŸ’¡ **The Foreground Prompt is Powerful BUT Optional**
- Blank foreground = subjects stay exactly as photographed
- This is often what you want!
- Only use if you specifically want modifications

ðŸ’¡ **Test with Cheap Photos First**
- Use single-subject photos when learning (5 credits)
- Master the system before tackling expensive group photos

ðŸ’¡ **Advanced Mode for Iteration**
- Generate background first (Step 2)
- Don't like it? Regenerate just Step 2 with new prompt
- Saves credits vs regenerating everything

ðŸ’¡ **Composition Settings Matter**
- Photo Remix uses Wallpaper Studio's composition settings
- Adjust Character Position, Lighting Style, Blending Mode in Section 3
- These affect Step 3 (Composite) quality

ðŸ’¡ **The Upload Area Shows Quality**
- After upload, you see original + cutout side-by-side
- If cutout looks clean, segmentation succeeded
- If cutout has artifacts, expect issues in final result

ðŸ’¡ **Group Photos: Foreground Blank = Big Savings**
- 3 people, no foreground = 5 credits
- 3 people, with foreground = 8 credits
- Only add foreground if you really need modifications!

ðŸ’¡ **Save Successful Prompts**
- When you get great result, save to collection
- View in Collection to see exact prompts used
- Reuse successful prompt structures for future remixes

---


## 14. TECHNICAL DEEP DIVE

### Architecture Overview

Photo Remix uses React `useReducer` with a dedicated `RemixState` slice for workflow management.

#### **RemixState Structure:**

```typescript
interface RemixState {
  originalImage: string | null;           // Your uploaded photo (full BG)
  cutoutImage: string | null;             // AI-segmented cutout (transparent BG)
  remixedCutoutImage: string | null;      // Modified cutout (from Step 1)
  generatedBackground: string | null;     // New scene (from Step 2)
  finalImage: string | null;              // Complete remix (from Step 3)
  backgroundPrompt: string;               // Scene description
  foregroundPrompt: string;               // Modification description
  isGroupPhoto: boolean;                  // Multi-subject toggle
  sceneSuggestions: SceneSuggestion[];   // AI-generated ideas
  detectedSubjects: DetectedSubject[] | null;  // Group photo analysis
}
```

**State Management:**
- All images stored as base64 data URLs
- Prompts updated via `SET_REMIX_STATE` action
- State persists across sessions (IndexedDB)
- Cleared via `CLEAR_REMIX_STATE` when new photo uploaded

---

### The Upload & Analysis Pipeline

#### **uploadAndAnalyze() Function Flow:**

```javascript
uploadAndAnalyze(file: File)
  â†“
1. Validation (is it an image file?)
  â†“
2. Clear previous remix state
  â†“
3. START_GENERATION dispatched
  â†“
4. FileReader converts to base64
  â†“
5. Store originalImage in state
  â†“
6. CRITICAL PATH: segmentImage() called
   â”œâ”€ AI removes background
   â”œâ”€ Creates transparent cutout
   â”œâ”€ Takes 5-10 seconds
   â””â”€ MUST succeed or entire upload fails
  â†“
7. Store cutoutImage in state
  â†“
8. NON-CRITICAL PATH: analyzeAndSuggestScenes() called
   â”œâ”€ AI analyzes photo
   â”œâ”€ Generates 4 creative ideas
   â”œâ”€ Takes 5-10 seconds
   â”œâ”€ If fails: Logs warning, continues anyway
   â””â”€ No longer breaks upload (recent fix!)
  â†“
9. Store sceneSuggestions in state
  â†“
10. FINISH_GENERATION dispatched
  â†“
11. Success log entry
```

**Key Architectural Decision (Recent Fix):**
- Segmentation and suggestions now DECOUPLED
- Segmentation = critical (must succeed)
- Suggestions = bonus (can fail gracefully)
- Makes upload process more resilient

---

### Simple Mode Generation Pipeline

#### **Single Subject Flow:**

```javascript
initiateSimpleGenerate()
  â†“
Pre-flight checks
  â†“
Confirmation dialog
  â†“
User confirms
  â†“
executeSingleSubjectRemix()
  â†“
Credits deducted (-5)
  â†“
PARALLEL EXECUTION:
  â”œâ”€ remixForeground(cutout, foregroundPrompt)  [if foreground filled]
  â””â”€ generateBackground(backgroundPrompt, original)
  â†“
Both complete
  â†“
State updated (remixed cutout + background)
  â†“
compositeImages([cutout], background, settings)
  â†“
Final image created
  â†“
State updated (finalImage)
  â†“
Success, added to Collection
```

**Parallel Optimization:**
- Subject remix and background generation happen simultaneously
- Saves 5-10 seconds!
- Most efficient pipeline

---

#### **Group Photo Flow:**

```javascript
initiateSimpleGenerate() with isGroupPhoto = true
  â†“
detectSubjectsInCutout(cutout)
  â”œâ”€ AI analyzes cutout
  â”œâ”€ Identifies each person
  â”œâ”€ Creates bounding box per person
  â””â”€ Returns array of subjects
  â†“
Calculate dynamic cost
  â†“
Show confirmation with cost
  â†“
User confirms
  â†“
executeGroupPhotoRemix(subjects, cost)
  â†“
Credits deducted
  â†“
PARALLEL EXECUTION:
  â”œâ”€ Background: generateBackground()
  â””â”€ Foreground: (if foreground prompt filled)
      â”œâ”€ Crop each person from cutout
      â”œâ”€ FOR each person:
      â”‚   â”œâ”€ remixForeground(personCutout, prompt)
      â”‚   â”œâ”€ 500ms delay (API pacing)
      â”‚   â””â”€ Store remixed person
      â”œâ”€ Stitch all remixed people back together
      â””â”€ Reassembled group cutout created
  â†“
Both paths complete
  â†“
compositeImages([reassembled], background, settings)
  â†“
Final group remix created
  â†“
Success, added to Collection
```

**Group-Specific Complexity:**
- Individual processing per person
- Stitching algorithm (canvas-based)
- More API calls = more time
- But higher quality per person!

---

### Advanced Mode: Individual Step Functions

#### **executeAdvancedRemixStep(step)**

```javascript
step = 'remix' | 'background' | 'composite'
  â†“
Validate prerequisites for step
  â†“
Show confirmation
  â†“
Credits deducted (1, 2, or 2 depending on step)
  â†“
IF step === 'remix':
  â””â”€ remixForeground(cutout, foregroundPrompt)
     â””â”€ Store in remixedCutoutImage
  
IF step === 'background':
  â””â”€ generateBackground(backgroundPrompt, original)
     â””â”€ Store in generatedBackground

IF step === 'composite':
  â””â”€ compositeImages([cutout], background, settings)
     â””â”€ Store in finalImage
  â†“
Result added to Collection (each step saved individually)
  â†“
Success log entry
```

**Step Independence:**
- Each step can be executed multiple times
- Each execution costs credits
- Results replace previous step results
- Enables iterative refinement

---

### The Three VFX API Functions

#### **1. remixForeground()**

**Purpose:** Modify subjects while preserving identity

**Input:**
- `cutoutBase64`: Subject image with transparent background
- `prompt`: Modification instructions

**AI Model:** `gemini-2.5-flash-image-preview`

**Prompt Structure:**
```
VFX Compositor persona
+ Task: Modify subject according to instructions
+ Constraints: Preserve identity, maintain transparency
+ Output: Modified subject, transparent BG
```

**What AI Does:**
- Analyzes subject
- Applies modifications to clothing/accessories
- Preserves face/bone structure (sacrosanct)
- Maintains edge quality
- Returns modified cutout

---

#### **2. generateBackground()**

**Purpose:** Create new photorealistic scene for compositing

**Input:**
- `prompt`: Scene description
- `originalImageBase64`: Reference for style matching

**AI Model:** `imagen-4.0-generate-001`

**Prompt Structure:**
```
VFX Compositor persona (scene creation specialist)
+ Mission: Generate compositing-ready background
+ Scene description: [User's background prompt]
+ Requirements: Clear lighting, depth, perspective
+ Context: Original photo for style reference
+ Output: Photorealistic background scene
```

**What AI Does:**
- Generates scene from description
- Establishes clear light sources
- Creates depth and perspective
- Considers original photo's style/mood
- Produces compositing-optimized scene

---

#### **3. compositeImages()**

**Purpose:** Professional VFX compositing with lighting/shadows

**Input:**
- `foregroundsBase64[]`: Array of subject cutouts
- `backgroundBase64`: Generated scene
- `settings`: Composition parameters

**AI Model:** `gemini-2.5-flash-image-preview`

**Prompt Structure:**
```
VFX Compositor persona (compositing specialist)
+ Mission: Create seamless photorealistic composite
+ Inputs: Background + Subject cutouts
+ Composition specs: Position, size, lighting, blending
+ Critical constraints: Lighting match, shadow generation, color grading, edge blending
+ Output: Final composite image
```

**What AI Does (The VFX Magic):**
1. Analyzes background lighting (direction, color, intensity)
2. Re-lights subjects to match background
3. Generates realistic shadows cast by subjects
4. Applies unified color grade
5. Refines cutout edges (eliminates harsh artifacts)
6. Positions subjects according to settings
7. Creates final seamless composite

**This is where the "magic" happens** - professional VFX quality!

---

### State Machine Visualization

```
STATE: Idle
  â†“ [upload photo]
STATE: Analyzing
  â†“ [segmentation complete]
STATE: Ready to Generate
  â†“ [click Generate]
STATE: Generating
  â†“ [simple mode]
STATE: Processing All Steps
  â†“ [completion]
STATE: Complete (finalImage exists)

OR

  â†“ [advanced mode]
STATE: Step 1 Available
  â†“ [click Step 1]
STATE: Step 1 Processing
  â†“ [Step 1 complete]
STATE: Step 2 Available
  â†“ [click Step 2]
STATE: Step 2 Processing
  â†“ [Step 2 complete]
STATE: Step 3 Available
  â†“ [click Step 3]
STATE: Step 3 Processing
  â†“ [Step 3 complete]
STATE: Complete (finalImage exists)
```

---

### Canvas-Based Image Processing

For group photos, Photo Remix uses HTML5 Canvas API for:

#### **cropImage() Function:**
```javascript
Purpose: Extract individual person from group cutout
Input: Full cutout + bounding box [y1, x1, y2, x2]
Process:
  1. Load cutout as Image object
  2. Calculate crop dimensions from normalized box
  3. Create canvas with crop dimensions
  4. Draw cropped portion to canvas
  5. Convert to data URL
Output: Individual person cutout
```

#### **stitchImages() Function:**
```javascript
Purpose: Reassemble group after individual processing
Input: Array of {image, boundingBox} pairs + original dimensions
Process:
  1. Create canvas with original dimensions
  2. For each person:
     - Load their processed image
     - Calculate position from bounding box
     - Draw to canvas at original position
  3. Convert to data URL
Output: Reassembled group cutout (all modifications applied)
```

**Why Client-Side Processing?**
- No server needed
- Instant results
- Privacy (images never uploaded to our servers)
- Full control over image manipulation

---

### Error Handling & Credit Refunds

#### **Automatic Refund System:**

ALL failures trigger immediate refunds:

```javascript
try {
  // Deduct credits
  dispatch({ type: 'CHANGE_CREDITS_BY', payload: { amount: -cost }});
  
  // Perform generation
  const result = await generate();
  
} catch (error) {
  // AUTOMATIC REFUND
  dispatch({ type: 'CHANGE_CREDITS_BY', payload: { amount: cost }});
  
  // User notification
  dispatch({ type: 'GENERATION_ERROR', payload: error.message });
  
  // Log refund
  dispatch({ type: 'ADD_LOG_ENTRY', payload: { 
    type: 'success', 
    message: `Refunded ${cost} credits` 
  }});
  
  // Save failure to collection for debugging
  dispatch({ type: 'ADD_RESULTS_TO_COLLECTION', payload: [failureResult] });
}
```

**You Never Lose Credits to Failures:**
- Network errors â†’ Refunded
- API errors â†’ Refunded
- Segmentation failures â†’ Never charged (happens before deduction)
- Any step failure in advanced mode â†’ That step refunded

---

### Recent Architectural Improvements

#### **Fix: Decoupled Suggestions from Segmentation**

**Before (Old Behavior):**
```javascript
// Brittle: Promise.all couples critical and non-critical operations
const [cutout, suggestions] = await Promise.all([
  segmentImage(photo),           // Critical
  analyzeAndSuggestScenes(photo) // Non-critical
]);
// If suggestions fail, ENTIRE upload fails!
```

**After (Current Behavior):**
```javascript
// Resilient: Critical and non-critical separated
const cutout = await segmentImage(photo); // Critical - must succeed

try {
  const suggestions = await analyzeAndSuggestScenes(photo); // Non-critical
} catch (error) {
  // Suggestions failed, but upload continues!
  console.warn('Suggestions unavailable, but you can write custom prompts');
  suggestions = [];
}
```

**Result:** Upload process 100% more reliable!

---

## 15. APPENDIX: QUICK REFERENCE

### Credit Cost Reference

**Single Subject:**
- Simple Mode: **5 credits** (all-inclusive)
- Advanced Mode:
  - Step 1 (Remix): 1 credit (optional)
  - Step 2 (Background): 2 credits (required)
  - Step 3 (Composite): 2 credits (required)
  - **Minimum:** 4 credits (if skip Step 1)
  - **Maximum:** 5 credits (all steps)

**Group Photo:**
- Base: 1 credit (detection)
- Per-Person Remix: 1 credit Ã— N people (if foreground used)
- Background: 2 credits
- Composite: 2 credits
- **Formula:** 1 + (N Ã— [0 or 1]) + 2 + 2
- **Examples:**
  - 2 people, no mods: 5 credits
  - 2 people, with mods: 7 credits
  - 3 people, no mods: 5 credits
  - 3 people, with mods: 8 credits
  - 5 people, with mods: 10 credits

---

### Default Workflow (Recommended for Beginners)

```
Section 1: Upload Your Photo
  - Group Photo?: OFF (unless 2+ people to keep)
  - Photo: Upload clear, single-subject photo

Section 2: Describe the New Scene
  - Option A: Click any AI-generated suggestion
  - Option B: Write custom prompts:
    - Background: Detailed scene description (required)
    - Foreground: Leave blank (keep subject as-is)

Section 3: Generation Mode
  - Advanced Mode: OFF (simple one-click)

Action Footer:
  - Click "Generate Remix (Cost: 5)"
  - Wait 30-40 seconds
  - View result
```

---

### Quick Prompt Templates

#### **Background Prompts by Genre:**

**Sci-Fi:**
```
[Futuristic location] with [tech elements], [lighting], [mood]

Example: A massive space station orbiting Earth, with holographic displays and metallic corridors, soft blue lighting, sense of isolation and wonder
```

**Fantasy:**
```
[Magical location] with [supernatural elements], [magical lighting], [mood]

Example: An enchanted forest with giant glowing mushrooms, ethereal mist, magical purple light filtering through canopy, sense of mystery
```

**Nature:**
```
[Natural location] at [time of day], [weather], [details], [mood]

Example: Mountain peak at sunrise, clear sky transitioning from purple to orange, snow-capped peaks, sense of achievement and peace
```

**Urban:**
```
[City type] at [time], [architectural details], [lighting], [activity]

Example: Cyberpunk Tokyo street at night, neon signs in Japanese, holographic advertisements, rain creating puddle reflections, bustling energy
```

---

#### **Foreground Prompts by Transformation Type:**

**Costume/Outfit Change:**
```
Transform clothing into [specific outfit with details]

Example: Transform clothing into sleek black tactical suit with armor plating and glowing cyan circuit patterns
```

**Prop Addition:**
```
Add [prop] in [position] with [details]

Example: Add futuristic energy rifle in right hand with glowing barrel and scope
```

**Effect Addition:**
```
Add [effect] with [characteristics]

Example: Add magical aura surrounding body with sparkling particles and soft purple glow
```

**Style Transformation:**
```
Transform into [artistic style] with [characteristics]

Example: Transform into oil painting style with visible brushstrokes and impressionist color palette
```

---

### Keyboard Shortcuts

- **Ctrl+V**: Paste image (anywhere in control panel)
- **Escape**: Close any modal
- **Ctrl+Z**: Undo (global)
- **Ctrl+Shift+Z**: Redo (global)

---

### Generation Time Reference

**Single Subject (Simple Mode):**
- Upload & Analysis: 10-15 seconds
- Generation (all steps): 25-35 seconds
- **Total**: ~40-50 seconds

**Single Subject (Advanced Mode):**
- Upload & Analysis: 10-15 seconds
- Step 1 (if used): 5-8 seconds
- Step 2: 10-15 seconds
- Step 3: 10-15 seconds
- **Total**: ~35-55 seconds

**Group Photo (2 people, no mods):**
- Upload & Analysis: 10-15 seconds
- Detection: 5-10 seconds
- Confirmation: [wait for user]
- Generation: 25-35 seconds
- **Total**: ~40-60 seconds

**Group Photo (3 people, with mods):**
- Upload & Analysis: 10-15 seconds
- Detection: 5-10 seconds
- Confirmation: [wait for user]
- Generation: 40-50 seconds (each person + stitching)
- **Total**: ~60-75 seconds

---

### Workflow Checklists

#### **Quick Remix Checklist:**
- [ ] Upload single-subject photo
- [ ] Wait for segmentation (cutout appears)
- [ ] Click any AI suggestion OR write custom background prompt
- [ ] Leave foreground blank (keep subject as-is)
- [ ] Leave Advanced Mode OFF
- [ ] Click "Generate Remix"
- [ ] Confirm (5 credits)
- [ ] Wait ~40 seconds
- [ ] View Before/After result
- [ ] Download or save

#### **Complete Transformation Checklist:**
- [ ] Upload clear photo
- [ ] Write detailed background prompt (where to place subjects)
- [ ] Write detailed foreground prompt (how to modify subjects)
- [ ] Set Group Photo toggle correctly
- [ ] Advanced Mode OFF (or ON if you want control)
- [ ] Generate
- [ ] Confirm cost
- [ ] Wait for completion
- [ ] Review result
- [ ] Iterate if needed

#### **Group Photo Checklist:**
- [ ] Upload photo with 2+ people
- [ ] Toggle "Group Photo?" ON
- [ ] Wait for segmentation
- [ ] Write background prompt
- [ ] Decide: Modify subjects? (fill foreground) or Keep as-is? (leave blank)
- [ ] Click Generate
- [ ] Review cost calculation (varies by people count)
- [ ] Confirm
- [ ] Wait (longer for groups)
- [ ] Review result

---

### Comparison: Photo Remix vs Alternatives

| Need | Use Photo Remix | Use Sticker Studio | Use Wallpaper Studio |
|------|----------------|-------------------|---------------------|
| Transform existing photo | âœ… YES | âŒ Different purpose | âŒ Different purpose |
| One-off transformation | âœ… YES | âš ï¸ Overkill | âš ï¸ Overkill |
| Reuse character | âŒ Re-process each time | âœ… Calibrate once | âœ… Create once |
| Group photos | âœ… Advanced processing | âŒ One person only | âœ… Multiple characters |
| Change background | âœ… Full control | âŒ No background | âœ… Full control |
| Modify subjects | âœ… Full control | âœ… Identity-locked | âœ… Pre-made characters |
| VFX Quality | âœ… Professional | âš ï¸ Sticker-focused | âœ… Professional |
| Cost per image | 5-15 credits | 1-20 credits/pack | 3 credits |

---

## CONCLUSION

Congratulations! You now have complete mastery of Photo Remix. This comprehensive guide covered:

âœ… Complete upload and analysis system
âœ… Dual-prompt architecture (background + foreground)
âœ… AI scene suggestions system
âœ… Simple vs Advanced generation modes
âœ… Group photo "Divide and Conquer" processing
âœ… The complete VFX pipeline (3 stages)
âœ… All 3 VFX API functions with prompt structures
âœ… Before/After preview system
âœ… Advanced step-by-step workflow
âœ… Credit optimization strategies
âœ… Professional tips and techniques
âœ… Technical architecture
âœ… Troubleshooting guide
âœ… Quick reference materials

---

### The Photo Remix Philosophy

**Remember These Core Principles:**

1. **Quality Input = Quality Output**
   - Clear photo with good lighting â†’ Professional remix
   - Blurry photo with poor lighting â†’ Mediocre remix

2. **Detailed Prompts = Better Results**
   - Vague: "A city" â†’ Generic
   - Detailed: "A rainy cyberpunk Tokyo street at night with neon reflections" â†’ Stunning

3. **VFX Compositor AI is Your Partner**
   - It understands professional compositing
   - It knows lighting, shadows, color theory
   - Trust the VFX process!

4. **Simple Mode is Powerful**
   - 95% of users never need Advanced mode
   - One click, professional results
   - Don't overthink it!

5. **Foreground Prompt is Optional**
   - Many best remixes use blank foreground
   - "Just change the scene" is perfectly valid
   - Only modify subjects if you have specific vision

---

### Your Photo Remix Journey

**Beginner Path:**
1. Upload single-subject photo
2. Use AI suggestions for first few remixes
3. Learn what works
4. Experiment with custom prompts
5. Stay in Simple mode

**Intermediate Path:**
1. Master custom prompt writing
2. Experiment with foreground modifications
3. Try group photos (2-3 people)
4. Occasionally use Advanced mode to troubleshoot
5. Build prompt library from successful remixes

**Advanced Path:**
1. Always use Advanced mode for control
2. Iterate on individual steps
3. Master group photo processing
4. Understand VFX principles
5. Create portfolio-quality composites
6. Optimize credit spending

---

### Final Thoughts

Photo Remix is the most advanced, VFX-quality feature in AI Sticker Studio. It represents cutting-edge AI compositing technology that was impossible just a few years ago.

**The Magic Formula:**
```
Great Photo + Detailed Scene Description + VFX Compositor AI = Hollywood-Quality Remix
```

**Remember:**
- Start simple (use AI suggestions)
- Be detailed in prompts
- Trust the VFX pipeline
- Iterate and learn
- Have fun creating impossible photos!

---

## 🔍 BEHIND THE SCENES: THE VFX PROMPTS

This section reveals the actual prompts used in the Photo Remix VFX pipeline. Understanding these prompts gives you insight into the professional-grade compositing happening behind the scenes.

### 1. Analysis & Suggestion Prompt

**Purpose**: Analyzes your uploaded photo and generates 4 creative remix suggestions  
**Model**: `gemini-2.5-flash`  
**Output**: JSON array of suggestions

```
You are a creative director for a visual effects studio. Analyze the subjects 
and context of this image and generate 4 diverse, creative ideas for a "photo remix". 
For each idea, provide a JSON object with three properties: 
- "title" (a short, catchy name for the idea)
- "backgroundPrompt" (a detailed prompt for an AI to generate a new background scene)
- "foregroundPrompt" (a detailed prompt for how to artistically modify the subjects to fit the new scene)

Return your answer as a valid JSON array of these objects.
```

**Example Output:**
```json
[
  {
    "title": "Superhero Landing",
    "backgroundPrompt": "A dramatic urban rooftop at sunset with city skyline in background, debris flying, action movie cinematography",
    "foregroundPrompt": "Transform subjects into superheroes mid-action pose with dynamic cape flowing, heroic lighting"
  },
  {
    "title": "Underwater Adventure",
    "backgroundPrompt": "A vibrant coral reef underwater scene with schools of tropical fish, sun rays penetrating water",
    "foregroundPrompt": "Add scuba gear to subjects, bubbles rising, hair and clothes flowing as if underwater"
  },
  ...
]
```

---

### 2. Image Segmentation Prompt

**Purpose**: Removes the background, isolating foreground subjects with perfect edges  
**Model**: `gemini-2.5-flash-image-preview`  
**Output**: Image with transparent background

```
Your single task is to perform a perfect, studio-quality background removal on this image. 
Isolate all foreground subjects from their background. The output MUST have a transparent 
alpha channel. Do not add any effects or change the subjects themselves.
```

**What It Does:**
- Detects all people/subjects in the photo
- Creates a precise cutout with smooth edges
- Preserves fine details (hair, fingers, clothing edges)
- Returns PNG with transparency

**Credit Cost**: FREE (no credits charged for segmentation alone)

---

### 3. Subject Detection Prompt (Group Photos Only)

**Purpose**: Identifies individual people in a group cutout and provides bounding boxes  
**Model**: `gemini-2.5-flash`  
**Output**: JSON array of detected subjects

```
Analyze this image with a transparent background. It contains one or more pre-segmented people.
Your task is to identify each individual person and provide a JSON array.
For each person, provide:
- 'id': A unique string identifier (e.g., "subject_1").
- 'description': A brief, non-identifying description (e.g., "person on the left with red shirt").
- 'boundingBox': A normalized bounding box [y_min, x_min, y_max, x_max] for that individual person.

Return ONLY the raw JSON array. If no one is found, return an empty array.
```

**Example Output:**
```json
[
  {
    "id": "subject_1",
    "description": "person on left wearing blue jacket",
    "boundingBox": [0.1, 0.05, 0.9, 0.45]
  },
  {
    "id": "subject_2",
    "description": "person on right wearing red dress",
    "boundingBox": [0.15, 0.55, 0.92, 0.95]
  }
]
```

---

### 4. VFX Compositor: Background Generation

**Purpose**: Creates a photorealistic scene optimized for compositing  
**Model**: `imagen-4.0-generate-001` (pure image generation, no image input)  
**Output**: High-resolution background scene

```
You are a Lead VFX Compositor from a world-class film studio, renowned for your mastery 
of photorealistic scene creation and lighting design. You specialize in creating environments 
that are perfectly suited for seamless photo compositing.

**Your Core Expertise:**
- Photorealistic Scene Generation: Creating believable, high-fidelity environments
- Lighting Design: Establishing clear, consistent light sources and atmospheric conditions
- Composition for Compositing: Designing scenes with appropriate depth, perspective, and space for subject integration
- Color & Mood: Creating cohesive color palettes that support photorealistic integration

**MISSION:** Generate a photorealistic background scene that will serve as the environment 
for a photo remix composite. This scene must have clear lighting direction, appropriate depth, 
and realistic atmospheric qualities to allow seamless subject integration.

**SCENE DESCRIPTION:**
[YOUR BACKGROUND PROMPT INSERTED HERE]

**CRITICAL REQUIREMENTS:**
- Scene must be photorealistic with clear, identifiable light sources
- Lighting direction and color temperature must be consistent throughout the scene
- Depth and perspective must be clearly established
- Scene should have appropriate atmospheric qualities (shadows, ambient light, environmental effects)
- High resolution and detail quality suitable for professional compositing
- Color palette should be cohesive and support natural subject integration

**CONTEXT:** The original photo context is provided as reference for matching general style, 
mood, or technical qualities if applicable to the requested scene.

**OUTPUT:** A single, high-resolution, photorealistic background scene optimized for compositing 
with a foreground subject.
```

**Why This Approach Works:**
- **Expert Persona** → AI understands it's creating compositing-grade scenes
- **Clear Light Sources** → Makes later lighting-match easier
- **Appropriate Depth** → Prevents subjects looking flat or disconnected
- **High Quality** → Professional-grade output, not cartoonish

---

### 5. VFX Compositor: Foreground Remix

**Purpose**: Artistically modifies your subjects while preserving their identity  
**Model**: `gemini-2.5-flash-image-preview`  
**Inputs**: Cutout image (with transparency) + modification prompt  
**Output**: Modified cutout (still transparent)

```
You are a Lead VFX Compositor from a world-class film studio, renowned for your mastery 
of photorealistic integration, light, and shadow. You specialize in seamlessly blending 
real-world elements with artistic modifications while preserving core identity.

**Your Core Expertise:**
- Photorealistic Integration: Seamlessly blending modifications with the original subject
- Identity Preservation: Maintaining exact facial features and defining characteristics
- Edge Blending: Creating natural transitions without harsh cutout edges
- Light & Color Matching: Ensuring artistic modifications match the subject's existing lighting

**PRIMARY DIRECTIVE:** The person's core facial features, bone structure, and identity 
MUST be preserved exactly. Only the requested artistic modifications should be applied.

**TASK:** Artistically modify the person in this pre-segmented image according to the 
following instruction, while maintaining their exact identity and facial features: 
"[YOUR FOREGROUND PROMPT INSERTED HERE]"

**CONSTRAINTS:**
- The person's facial structure, features, and identity are sacrosanct and cannot be altered
- Apply only the specific modifications requested in the instruction
- Maintain photorealistic quality in all modifications
- The output image MUST retain its transparent background (alpha channel)
- Blend all modifications seamlessly with the original subject

**OUTPUT:** A single, high-quality image with transparent background, featuring the requested 
modifications while preserving the person's exact identity.
```

**Examples of What This Does:**
- "Add superhero cape and mask" → Adds costume while keeping your face
- "Transform into astronaut" → Adds spacesuit while preserving identity
- "Add wizard robes and magical staff" → Costume + prop while keeping you recognizable
- "" (blank) → No modifications, just prepares cutout for compositing

**Identity Preservation:**
The AI is explicitly instructed to preserve:
- Facial features and bone structure
- Skin tone
- Hair style and color
- Body proportions
- Distinctive features (glasses, tattoos, etc.)

---

### 6. VFX Compositor: Final Compositing

**Purpose**: Seamlessly integrates modified foreground(s) onto the new background  
**Model**: `gemini-2.5-flash-image-preview`  
**Inputs**: Background image + 1 or more foreground cutouts  
**Output**: Final, photorealistic composite

```
You are a Lead VFX Compositor from a world-class film studio, renowned for your mastery 
of photorealistic compositing, light, and shadow. You are the final step in creating seamless, 
believable composite images where subjects look naturally present in their new environment.

**Your Core Expertise:**
- Photorealistic Integration: Making pre-segmented subjects look physically present in new scenes
- Light & Color Matching: Analyzing scene lighting and re-lighting subjects to match perfectly
- Shadow Generation: Creating realistic shadows that anchor subjects to their environment
- Edge Blending: Refining cutout edges to eliminate any "pasted-on" appearance
- Color Grading: Unifying the color palette across all elements for seamless integration

**PRIMARY DIRECTIVE:** Your highest priority is to create a seamless, photorealistic composite 
where the foreground subject(s) look naturally and physically present in the background scene. 
The final image must be indistinguishable from a photograph taken in that environment.

**THE DIGITAL DAILIES:**
You have been provided with:
- A background scene (first image)
- One or more pre-segmented foreground subject(s) with transparent backgrounds
- Composition specifications

**CRITICAL CONSTRAINTS:**
- Lighting & Shadow: The lighting on each subject MUST be altered to match the direction, 
  color, and intensity of the lighting in the background scene. You MUST generate realistic 
  shadows cast by each subject onto the background.
- Color Grading: The final image MUST have a unified color grade. Subjects cannot look 
  "warmer" or "cooler" than their environment.
- Perspective & Scale: Position and scale subjects consistently with the background's perspective.
- Edge Blending: Meticulously refine subject edges to eliminate harsh cutout artifacts.

**COMPOSITION SPECIFICATIONS:**
- Character Position: [center/left/right/top/bottom]
- Character Size: [X]% of scene height
- Blending Mode: [Realistic/Seamless/Dramatic/Subtle]
- Lighting Style: [Match Background/Enhanced/Dramatic/Soft]

**OUTPUT:** A single, high-resolution, photorealistic composite image where all subjects 
are seamlessly integrated into the background scene.
```

**The Critical VFX Magic:**

This prompt does 5 things simultaneously:

1. **Re-lighting**: Analyzes background light direction → modifies subject lighting to match
2. **Shadow Generation**: Creates cast shadows from subjects onto background
3. **Color Grading**: Unifies warm/cool tones across all elements
4. **Edge Refinement**: Smooths cutout edges for natural blending
5. **Perspective Matching**: Positions subjects correctly for scene depth

**This is why Photo Remix costs 5-15 credits** → It's using advanced multimodal AI to perform professional-grade VFX work that would take hours in Photoshop!

---

### 7. The Complete VFX Pipeline in One Diagram

```
┌─────────────────────────────────────────────────────────────┐
│ STEP 1: UPLOAD & ANALYZE (FREE)                            │
├─────────────────────────────────────────────────────────────┤
│ Input: Your original photo                                  │
│ Prompt: "Analyze and suggest 4 remix ideas..."             │
│ Model: gemini-2.5-flash                                     │
│ Output: 4 AI suggestions (JSON)                             │
│ Credit Cost: 0 credits                                      │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ STEP 2: SEGMENTATION (FREE)                                │
├─────────────────────────────────────────────────────────────┤
│ Input: Original photo                                       │
│ Prompt: "Perform studio-quality background removal..."     │
│ Model: gemini-2.5-flash-image-preview                      │
│ Output: Cutout with transparency                            │
│ Credit Cost: 0 credits                                      │
└─────────────────────────────────────────────────────────────┘
                            ↓
    ┌───────────────────────┴───────────────────────┐
    │ GROUP PHOTO?                                   │
    ├───────────────────────┬───────────────────────┤
    │ YES → Detect & Crop   │ NO → Continue          │
    │ (gemini-2.5-flash)    │                        │
    └───────────────────────┴───────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ STEP 3: BACKGROUND GENERATION (5 credits)                  │
├─────────────────────────────────────────────────────────────┤
│ Input: Your background prompt                               │
│ Prompt: "Lead VFX Compositor... photorealistic scene..."   │
│ Model: imagen-4.0-generate-001                              │
│ Output: High-res background scene                           │
│ Credit Cost: 5 credits                                      │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ STEP 4: FOREGROUND REMIX (5 credits per subject)           │
├─────────────────────────────────────────────────────────────┤
│ Input: Cutout(s) + foreground prompt                        │
│ Prompt: "Lead VFX Compositor... artistic modifications..." │
│ Model: gemini-2.5-flash-image-preview                      │
│ Output: Modified cutout(s) with transparency                │
│ Credit Cost: 5 credits × number of subjects                │
│ (Skipped if foreground prompt is blank)                    │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ STEP 5: FINAL COMPOSITING (5 credits)                      │
├─────────────────────────────────────────────────────────────┤
│ Input: Background + modified foreground(s)                  │
│ Prompt: "Lead VFX Compositor... seamless integration..."   │
│ Model: gemini-2.5-flash-image-preview                      │
│ Output: Final photorealistic composite                      │
│ Credit Cost: 5 credits                                      │
└─────────────────────────────────────────────────────────────┘
                            ↓
                     YOUR REMIX! ✨
```

---

### 8. Prompt Optimization Tips

Now that you know the actual prompts, here's how to write better input prompts:

#### For Background Prompts:

✅ **DO** include:
- Specific location ("Tokyo street", "Victorian library", "Mars surface")
- Lighting details ("golden hour", "neon lights", "studio lighting")
- Atmospheric effects ("foggy", "sun rays", "rain")
- Mood/style ("cinematic", "dreamlike", "gritty realistic")

❌ **DON'T** include:
- References to people ("with a person standing", "someone walking by")
- Vague descriptions ("nice place", "cool scene")
- Multiple disconnected ideas ("forest AND city AND space")

**Why?** The VFX Compositor prompt emphasizes:
- Clear light sources
- Consistent lighting direction
- Appropriate depth and perspective
- Professional compositing quality

Your prompt should feed into these requirements!

#### For Foreground Prompts:

✅ **DO** include:
- Costume/clothing changes ("wearing astronaut suit", "superhero cape")
- Props ("holding magic wand", "with lightsaber")
- Style transformations ("in anime art style", "as a comic book character")
- Action/pose modifications ("heroic stance", "jumping mid-air")

❌ **DON'T** include:
- Face changes ("change eyes", "different nose")
- Identity modifications ("make them look like X celebrity")
- Background references ("standing in forest")

**Why?** The foreground prompt explicitly preserves:
- Facial features and bone structure
- Core identity
- Transparent background

It only modifies costume, props, style, and pose!

#### The "Blank Foreground" Strategy:

**Most successful remixes use a blank foreground prompt!**

Why? Because:
1. The compositing step handles all lighting/shadow matching
2. You preserve your natural appearance
3. It's 5 credits cheaper (skips foreground remix)
4. Faster generation (one less step)

Only add a foreground prompt if you want:
- Costume changes
- Props
- Style transformation
- Artistic modifications

Otherwise, leave it blank and let the VFX compositor do its magic!

---

### 9. Model Selection & Cost Breakdown

| Step | Model | Why This Model? | Credits |
|------|-------|----------------|---------|
| **Analysis** | gemini-2.5-flash | Fast JSON generation | 0 |
| **Segmentation** | gemini-2.5-flash-image-preview | Image editing with transparency | 0 |
| **Subject Detection** | gemini-2.5-flash | Fast JSON for bounding boxes | 0 |
| **Background** | imagen-4.0-generate-001 | Pure image generation (no input image) | 5 |
| **Foreground Remix** | gemini-2.5-flash-image-preview | Multi-image input + editing | 5 per subject |
| **Compositing** | gemini-2.5-flash-image-preview | Multi-image input + advanced compositing | 5 |

**Credit Calculation Examples:**

- **Simple Mode (1 person, blank foreground)**:
  - Background: 5 credits
  - Foreground: 0 credits (skipped)
  - Composite: 5 credits
  - **Total: 10 credits**

- **Simple Mode (1 person, with foreground)**:
  - Background: 5 credits
  - Foreground: 5 credits
  - Composite: 5 credits
  - **Total: 15 credits**

- **Group Photo (2 people, blank foreground)**:
  - Background: 5 credits
  - Foreground Subject 1: 0 credits (skipped)
  - Foreground Subject 2: 0 credits (skipped)
  - Composite: 5 credits
  - **Total: 10 credits**

- **Group Photo (2 people, with foreground)**:
  - Background: 5 credits
  - Foreground Subject 1: 5 credits
  - Foreground Subject 2: 5 credits
  - Composite: 5 credits
  - **Total: 20 credits**

**Pro Tip:** For group photos, blank foreground = huge savings!

---

### 10. What Makes These Prompts Special?

**The "Four Pillars" Prompt Engineering Framework:**

All Photo Remix prompts follow this structure:

1. **Expert Persona**  
   "You are a Lead VFX Compositor from a world-class film studio..."  
   → AI understands the professional context and quality expectations

2. **Rich Context**  
   Multiple images + detailed specifications + composition settings  
   → AI has all information needed for informed decisions

3. **Unambiguous Constraints**  
   "MUST have transparent background", "MUST match lighting direction", etc.  
   → Removes ambiguity, reduces failures

4. **Precise Output Formatting**  
   "Single, high-resolution, photorealistic composite image..."  
   → AI knows exactly what format to return

**This is cutting-edge prompt engineering** based on professional VFX workflows, adapted for AI image generation!

---

### 11. Advanced: Iterating on Failed Composites

If a composite looks wrong, here's how to diagnose using prompt knowledge:

**Problem: Lighting doesn't match**
- **Cause**: Background scene has ambiguous light sources
- **Fix**: Regenerate background with clearer lighting ("strong sunlight from the right", "overhead neon lights")

**Problem: Subject looks "pasted on"**
- **Cause**: Compositing step failed to blend edges
- **Fix**: Use Advanced mode, regenerate only the composite step with "Seamless" blending mode

**Problem: Colors don't match**
- **Cause**: Background and foreground have conflicting color temperatures
- **Fix**: Regenerate background with color palette description ("warm golden tones", "cool blue atmosphere")

**Problem: Subject size/position wrong**
- **Cause**: Composition settings don't match scene perspective
- **Fix**: Adjust "Character Size" slider before regenerating

**Problem: Identity changed**
- **Cause**: Foreground prompt asked for face modifications
- **Fix**: Remove face-related instructions from foreground prompt (remember: identity is preserved automatically!)

---

### 12. The VFX Compositor "Secret Sauce"

**Why does Photo Remix produce Hollywood-quality results?**

Because the prompts encode **real VFX principles**:

1. **Segmentation-First Workflow**  
   Professional compositors always work with clean cutouts → We do segmentation before any editing

2. **Separate Background/Foreground Passes**  
   Film VFX generates elements separately → We generate background and foreground independently

3. **Lighting Direction Analysis**  
   Real compositors analyze scene lighting before integrating subjects → Our prompts emphasize "identify light sources"

4. **Shadow Generation**  
   Professional composites always include cast shadows → Our prompts mandate "generate realistic shadows"

5. **Unified Color Grading**  
   Final VFX pass always includes color grading → Our compositing prompt requires "unified color palette"

**This isn't just an AI filter** → It's a **complete VFX pipeline** compressed into 3 API calls!

---

**END OF PHOTO REMIX COMPLETE GUIDE**

For questions, issues, or feedback about the photo remix feature, please refer to the project documentation or submit an issue on the repository.

**Version**: 1.0  
**Document Type**: Comprehensive User Guide  
**Last Updated**: October 17, 2025  
**Companion Guides**: 
- STICKER_STUDIO_COMPLETE_GUIDE.md
- WALLPAPER_STUDIO_COMPLETE_GUIDE.md

---

*Created with precision and VFX expertise for the AI Sticker Studio community.*

